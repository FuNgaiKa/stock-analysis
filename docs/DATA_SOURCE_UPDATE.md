# 数据源更新说明

## 更新时间
2025-10-13

## 变更内容

### A股市场分析器 (cn_market_analyzer.py)

**变更前**: 使用 yfinance 获取A股数据
- 问题: 创业板指(399006.SZ)和科创50(000688.SS)数据不完整,只能获取1天数据
- 影响: 无法进行历史点位分析

**变更后**: 使用 Ashare 数据源(腾讯+新浪双核心)
- 优势:
  - ✅ 支持完整的A股历史数据
  - ✅ 创业板指、科创50等指数数据完整
  - ✅ 双核心备份,稳定性高
  - ✅ 国内数据源,访问速度快
- 支持的指数:
  - 上证指数 (000001)
  - 深证成指 (399001)
  - 创业板指 (399006)
  - 沪深300 (000300)
  - 中证500 (000905)
  - 科创50 (000688)

### 港股市场分析器 (hk_market_analyzer.py)

**保持不变**: 继续使用 yfinance
- 原因: yfinance 对港股数据支持良好,Ashare不支持港股
- 支持的指数:
  - 恒生指数 (^HSI)
  - 国企指数 (^HSCE)
  - 恒生科技 (3032.HK - ETF代理)

### 美股市场分析器 (us_market_analyzer.py)

**保持不变**: 继续使用 yfinance
- 支持的指数:
  - 标普500 (^GSPC)
  - 纳斯达克综合 (^IXIC)
  - 纳斯达克100 (^NDX)
  - VIX恐慌指数 (^VIX)
  - 道琼斯工业 (^DJI)
  - 罗素2000 (^RUT)

## 功能增强

### 新增完整分析功能

现在所有市场分析器都支持:
1. ✅ 历史相似点位匹配
2. ✅ 上涨/下跌概率统计
3. ✅ 平均收益率预测
4. ✅ 置信度计算
5. ✅ 仓位建议(基于Kelly公式优化)
6. ✅ 操作信号生成

### 分析示例

```python
from position_analysis.cn_market_analyzer import CNMarketAnalyzer

analyzer = CNMarketAnalyzer()

# 分析创业板指
result = analyzer.analyze_single_index('CYBZ', tolerance=0.05)

# 输出示例:
# 当前点位: 3113.26 (-4.55%)
# 相似时期: 122 个
# 20日后上涨概率: 63.6%
# 平均收益率: -0.26%
# 置信度: 70.8%
# 建议仓位: 50%
# 操作信号: 中性
```

## 测试结果

### A股指数测试 (2025-10-13)

| 指数 | 当前点位 | 相似点位数 | 20日上涨概率 | 平均收益 | 操作信号 | 建议仓位 |
|------|---------|-----------|------------|---------|---------|---------|
| 沪深300 | 4616.83 | 96 | 34.6% | -3.01% | 卖出 | 30% |
| 创业板指 | 3113.26 | 122 | 63.6% | -0.26% | 中性 | 50% |
| 科创50 | 1452.67 | 183 | 28.6% | -2.40% | 卖出 | 30% |

### 港股指数测试

| 指数 | 当前点位 | 相似点位数 | 20日上涨概率 | 平均收益 | 操作信号 | 建议仓位 |
|------|---------|-----------|------------|---------|---------|---------|
| 恒生指数 | 26290.32 | 156 | 45.0% | +0.22% | 中性 | 47.5% |
| 恒生科技 | 6.22 | 81 | 35.3% | -3.51% | 中性 | 50% |

### 美股指数测试

| 指数 | 当前点位 | 相似点位数 | 20日上涨概率 | 平均收益 | 操作信号 | 建议仓位 |
|------|---------|-----------|------------|---------|---------|---------|
| 标普500 | 6552.51 | 66 | 96.1% | +2.26% | 强买入 | 86% |
| 纳斯达克综合 | 22204.43 | 47 | - | - | - | - |
| 纳斯达克100 | 24221.74 | 55 | - | - | - | - |

## 注意事项

1. **数据更新频率**: Ashare使用腾讯/新浪实时数据,yfinance有15-20分钟延迟
2. **历史数据范围**:
   - Ashare: 支持获取全部历史数据
   - yfinance: 一般支持近10年数据
3. **网络要求**:
   - Ashare: 国内访问,速度快
   - yfinance: 海外服务,可能需要代理

## 相关文件

- `/position_analysis/cn_market_analyzer.py` - A股市场分析器
- `/position_analysis/hk_market_analyzer.py` - 港股市场分析器
- `/position_analysis/us_market_analyzer.py` - 美股市场分析器
- `/data_sources/Ashare.py` - Ashare数据源(腾讯+新浪双核心)
- `/data_sources/us_stock_source.py` - yfinance数据源

## 向后兼容

所有API接口保持不变,只是底层数据源切换,不影响现有代码调用。
