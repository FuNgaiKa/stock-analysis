# ç¾è‚¡/æ¸¯è‚¡ä¸‰å¤§æ ¸å¿ƒæŒ‡æ ‡å®ç°è¯´æ˜

**æ–‡æ¡£**: æ•°æ®æºé™åˆ¶ä¸è§£å†³æ–¹æ¡ˆ
**æ—¥æœŸ**: 2025-10-28
**ä½œè€…**: Claude Code

---

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜ç¾è‚¡/æ¸¯è‚¡ä¸‰å¤§æ ¸å¿ƒæŒ‡æ ‡ï¼ˆä¼°å€¼åˆ†æã€å¸‚åœºå®½åº¦ã€èèµ„èåˆ¸ï¼‰çš„å®ç°çŠ¶æ€ã€æ•°æ®æºé™åˆ¶å’Œè§£å†³æ–¹æ¡ˆã€‚

---

## ğŸ‡ºğŸ‡¸ ç¾è‚¡å¸‚åœº

### 1ï¸âƒ£ ä¼°å€¼åˆ†æ

#### å½“å‰çŠ¶æ€: âš ï¸ éƒ¨åˆ†å®ç°

**å®ç°æ–¹å¼**ï¼š
- ä½¿ç”¨ä»·æ ¼å†å²åˆ†ä½æ•°ä½œä¸ºä¼°å€¼çš„è¿‘ä¼¼æŒ‡æ ‡
- æ–‡ä»¶ï¼š`analyzers/valuation/us_valuation_analyzer.py`

**æ•°æ®æº**ï¼š
- âœ… å¯ç”¨ï¼šyfinanceæä¾›ä»·æ ¼å†å²æ•°æ®
- âŒ ç¼ºå¤±ï¼šå†å²PE/PBæ•°æ®

**é™åˆ¶**ï¼š
```
yfinanceä¸æä¾›å†å²PE/PBæ•°æ®
åªèƒ½è·å–å½“å‰PEï¼Œæ— æ³•è®¡ç®—å†å²åˆ†ä½æ•°
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

| æ–¹æ¡ˆ | æ•°æ®æº | æˆæœ¬ | éš¾åº¦ | æ¨èåº¦ |
|------|--------|------|------|--------|
| 1. ä»·æ ¼åˆ†ä½æ•°ä»£ç† | yfinance | å…è´¹ | â­ | â­â­â­ (å½“å‰) |
| 2. Shiller PE (CAPE) | [Robert Shillerå®˜ç½‘](http://www.econ.yale.edu/~shiller/data.htm) | å…è´¹ | â­â­ | â­â­â­â­â­ |
| 3. S&P Globalæ•°æ® | S&P Capital IQ | ä»˜è´¹ | â­â­â­ | â­â­â­â­ |
| 4. Alpha Vantage API | Alpha Vantage | å…è´¹/ä»˜è´¹ | â­â­ | â­â­â­â­ |

**æœ€ä½³å®è·µ**ï¼š
1. çŸ­æœŸï¼šä½¿ç”¨ä»·æ ¼åˆ†ä½æ•°ä½œä¸ºè¿‘ä¼¼
2. ä¸­æœŸï¼šè¡¥å……Shiller PEæ•°æ®ï¼ˆCSVä¸‹è½½ï¼Œå®šæœŸæ›´æ–°ï¼‰
3. é•¿æœŸï¼šæ¥å…¥Alpha Vantageæˆ–ä»˜è´¹æ•°æ®æœåŠ¡

---

### 2ï¸âƒ£ å¸‚åœºå®½åº¦

#### å½“å‰çŠ¶æ€: âŒ æ¡†æ¶å·²å»ºï¼Œç¼ºæ•°æ®æº

**å®ç°æ–¹å¼**ï¼š
- æ¡†æ¶å·²å»ºç«‹ï¼Œç­‰å¾…æ•°æ®æº
- æ–‡ä»¶ï¼š`analyzers/market_structure/us_market_breadth_analyzer.py`

**æ•°æ®æº**ï¼š
- âŒ yfinanceï¼šä¸æä¾›NYSEæ¶¨è·Œå®¶æ•°
- âŒ yfinanceï¼šä¸æä¾›Advance/Decline Line

**éœ€è¦çš„æ•°æ®**ï¼š
- NYSE Advancing Issues (æ¶¨å®¶æ•°)
- NYSE Declining Issues (è·Œå®¶æ•°)
- New Highs / New Lows (æ–°é«˜æ–°ä½)

**è§£å†³æ–¹æ¡ˆ**ï¼š

| æ–¹æ¡ˆ | æ•°æ®æº | æˆæœ¬ | éš¾åº¦ | æ¨èåº¦ |
|------|--------|------|------|--------|
| 1. Alpha Vantage API | `TIME_SERIES_INTRADAY` | å…è´¹/ä»˜è´¹ | â­â­â­ | â­â­â­â­ |
| 2. IEX Cloud | IEX Stats API | ä»˜è´¹ | â­â­ | â­â­â­â­ |
| 3. NYSEå®˜æ–¹æ•°æ® | NYSE Data Portal | å…è´¹ | â­â­â­â­ | â­â­â­ |
| 4. S&P500æˆåˆ†è‚¡ç»Ÿè®¡ | yfinance + è®¡ç®— | å…è´¹ | â­â­â­ | â­â­â­ (workaround) |

**ä¸´æ—¶æ–¹æ¡ˆ**ï¼š
```python
# ä½¿ç”¨S&P500æˆåˆ†è‚¡çš„æ¶¨è·Œç»Ÿè®¡
def calculate_sp500_breadth():
    """ç»Ÿè®¡S&P500ä¸­ä¸Šæ¶¨/ä¸‹è·Œçš„è‚¡ç¥¨æ•°é‡"""
    tickers = get_sp500_tickers()
    advances = 0
    declines = 0

    for ticker in tickers:
        change = get_daily_change(ticker)
        if change > 0:
            advances += 1
        elif change < 0:
            declines += 1

    return advances, declines
```

**æœ€ä½³å®è·µ**ï¼š
1. çŸ­æœŸï¼šä½¿ç”¨S&P500æˆåˆ†è‚¡ç»Ÿè®¡ä½œä¸ºè¿‘ä¼¼
2. ä¸­æœŸï¼šæ¥å…¥Alpha Vantageæˆ–IEX Cloud
3. é•¿æœŸï¼šä½¿ç”¨ä¸“ä¸šæ•°æ®æœåŠ¡

---

### 3ï¸âƒ£ èèµ„èåˆ¸

#### å½“å‰çŠ¶æ€: âŒ æ¡†æ¶å·²å»ºï¼Œç¼ºæ•°æ®æº

**å®ç°æ–¹å¼**ï¼š
- æ¡†æ¶å·²å»ºç«‹ï¼Œç­‰å¾…æ•°æ®æº
- æ–‡ä»¶ï¼š`analyzers/market_specific/us_margin_debt_analyzer.py`

**æ•°æ®æº**ï¼š
- âŒ yfinanceï¼šä¸æä¾›Margin Debtæ•°æ®
- âœ… FINRAå®˜ç½‘ï¼šæ¯æœˆå‘å¸ƒExcelæ–‡ä»¶

**FINRAæ•°æ®**ï¼š
- URL: https://www.finra.org/investors/learn-to-invest/advanced-investing/margin-statistics
- æ ¼å¼ï¼šExcel (.xls)
- æ›´æ–°é¢‘ç‡ï¼šæœˆåº¦
- å»¶è¿Ÿï¼šçº¦15å¤©

**è§£å†³æ–¹æ¡ˆ**ï¼š

| æ–¹æ¡ˆ | æ•°æ®æº | æˆæœ¬ | éš¾åº¦ | æ¨èåº¦ |
|------|--------|------|------|--------|
| 1. VIXä½œä¸ºä»£ç†æŒ‡æ ‡ | yfinance | å…è´¹ | â­ | â­â­â­ (å½“å‰) |
| 2. FINRA Excelä¸‹è½½ | FINRAå®˜ç½‘ | å…è´¹ | â­â­ | â­â­â­â­ |
| 3. Web Scraper | è‡ªåŠ¨æŠ“å–FINRA | å…è´¹ | â­â­â­ | â­â­â­â­ |
| 4. Put/Call Ratio | CBOEæ•°æ® | å…è´¹ | â­â­ | â­â­â­ |

**ä¸´æ—¶æ–¹æ¡ˆ**ï¼š
```python
# ä½¿ç”¨VIXä½œä¸ºæƒ…ç»ªä»£ç†
def analyze_sentiment_via_vix():
    """é€šè¿‡VIXåˆ¤æ–­å¸‚åœºæƒ…ç»ª"""
    vix = get_vix_current()

    if vix > 30:
        return "æåº¦ææ…Œ (ç±»ä¼¼èèµ„å»æ æ†)"
    elif vix > 20:
        return "ææ…Œ"
    elif vix < 12:
        return "æåº¦ä¹è§‚ (ç±»ä¼¼èèµ„åŠ æ æ†)"
    else:
        return "æ­£å¸¸"
```

**æœ€ä½³å®è·µ**ï¼š
1. çŸ­æœŸï¼šä½¿ç”¨VIXä½œä¸ºæƒ…ç»ªä»£ç†
2. ä¸­æœŸï¼šå®šæœŸä¸‹è½½FINRA Excelæ–‡ä»¶ï¼Œæ‰‹åŠ¨æ›´æ–°
3. é•¿æœŸï¼šå¼€å‘web scraperè‡ªåŠ¨æŠ“å–FINRAæ•°æ®

---

## ğŸ‡­ğŸ‡° æ¸¯è‚¡å¸‚åœº

### 1ï¸âƒ£ ä¼°å€¼åˆ†æ

#### å½“å‰çŠ¶æ€: âŒ æœªå®ç°

**æ•°æ®æº**ï¼š
- æ¸¯äº¤æ‰€ï¼šæä¾›æ’ç”ŸæŒ‡æ•°ç­‰PE/PBæ•°æ®
- Wind/å½­åšï¼šä»˜è´¹æ•°æ®æœåŠ¡

**è§£å†³æ–¹æ¡ˆ**ï¼š

| æ–¹æ¡ˆ | æ•°æ®æº | æˆæœ¬ | éš¾åº¦ | æ¨èåº¦ |
|------|--------|------|------|--------|
| 1. æ¸¯äº¤æ‰€å®˜ç½‘ | æ‰‹åŠ¨ä¸‹è½½ | å…è´¹ | â­â­â­ | â­â­â­ |
| 2. yfinance | ä»·æ ¼ä»£ç† | å…è´¹ | â­ | â­â­ |
| 3. Wind/å½­åš | API | ä»˜è´¹ | â­â­ | â­â­â­â­â­ |

---

### 2ï¸âƒ£ å¸‚åœºå®½åº¦

#### å½“å‰çŠ¶æ€: âŒ æœªå®ç°

**æ•°æ®æº**ï¼š
- éœ€è¦æ¸¯è‚¡æ–°é«˜æ–°ä½æ•°æ®
- æ¸¯äº¤æ‰€å¯èƒ½æä¾›éƒ¨åˆ†æ•°æ®

**è§£å†³æ–¹æ¡ˆ**ï¼šç±»ä¼¼ç¾è‚¡ï¼Œéœ€è¦é¢å¤–æ•°æ®æº

---

### 3ï¸âƒ£ èèµ„èåˆ¸

#### å½“å‰çŠ¶æ€: âŒ æœªå®ç°

**æ•°æ®æº**ï¼š
- æ¸¯äº¤æ‰€æ¯æ—¥å…¬å¸ƒèèµ„èåˆ¸æ•°æ®
- éœ€è¦é€‚é…æ•°æ®æ ¼å¼

**è§£å†³æ–¹æ¡ˆ**ï¼šä»æ¸¯äº¤æ‰€ç½‘ç«™è·å–æ•°æ®

---

## ğŸ“Š æ€»ç»“å¯¹æ¯”è¡¨

### Aè‚¡ vs ç¾è‚¡ vs æ¸¯è‚¡

| æŒ‡æ ‡ | Aè‚¡ | ç¾è‚¡ | æ¸¯è‚¡ |
|------|-----|------|------|
| **ä¼°å€¼åˆ†æ** | âœ… å®Œæ•´ | âš ï¸ ä»·æ ¼ä»£ç† | âŒ æœªå®ç° |
| **å¸‚åœºå®½åº¦** | âœ… å®Œæ•´ | âŒ éœ€æ•°æ®æº | âŒ æœªå®ç° |
| **èèµ„èåˆ¸** | âœ… å®Œæ•´ | âŒ éœ€æ•°æ®æº | âŒ æœªå®ç° |

### æ•°æ®æºæˆæœ¬å¯¹æ¯”

| æ•°æ®æº | ç±»å‹ | æˆæœ¬/æœˆ | è¦†ç›–å¸‚åœº |
|--------|------|---------|----------|
| yfinance | å…è´¹ | $0 | å…¨çƒï¼ˆæœ‰é™ï¼‰ |
| akshare | å…è´¹ | $0 | Aè‚¡ |
| Alpha Vantage | å…è´¹/ä»˜è´¹ | $0-$500 | å…¨çƒ |
| IEX Cloud | ä»˜è´¹ | $9-$499 | ç¾è‚¡ |
| Bloomberg | ä»˜è´¹ | $2000+ | å…¨çƒ |

---

## ğŸš€ å®æ–½å»ºè®®

### Phase 1: MVP (å½“å‰)

**Aè‚¡**ï¼š
- âœ… ä¸‰ä¸ªæŒ‡æ ‡å…¨éƒ¨å®ç°
- âœ… å®Œæ•´çš„åˆ†ææŠ¥å‘Š

**ç¾è‚¡**ï¼š
- âš ï¸ ä¼°å€¼ï¼šä½¿ç”¨ä»·æ ¼åˆ†ä½æ•°
- âŒ å®½åº¦ï¼šæ˜¾ç¤º"éœ€è¦æ•°æ®æº"æç¤º
- âŒ èèµ„ï¼šä½¿ç”¨VIXä½œä¸ºä»£ç†

**æ¸¯è‚¡**ï¼š
- âŒ æš‚ä¸æ”¯æŒä¸‰ä¸ªæŒ‡æ ‡

### Phase 2: å¢å¼ºç‰ˆï¼ˆ1-2å‘¨ï¼‰

**ç¾è‚¡**ï¼š
1. è¡¥å……Shiller PEæ•°æ®ï¼ˆCSVä¸‹è½½ï¼‰
2. å®ç°S&P500æˆåˆ†è‚¡å®½åº¦ç»Ÿè®¡
3. å®šæœŸä¸‹è½½FINRAæ•°æ®

**æ¸¯è‚¡**ï¼š
- å¼€å§‹è°ƒç ”æ•°æ®æº

### Phase 3: ä¸“ä¸šç‰ˆï¼ˆ1-2æœˆï¼‰

**ç¾è‚¡**ï¼š
1. æ¥å…¥Alpha Vantage API
2. å¼€å‘FINRA web scraper
3. å®Œæ•´å®ç°ä¸‰ä¸ªæŒ‡æ ‡

**æ¸¯è‚¡**ï¼š
1. å®ç°ä¼°å€¼åˆ†æ
2. å®ç°èèµ„èåˆ¸åˆ†æ

---

## ğŸ’¡ ä»£ç ç¤ºä¾‹

### å¦‚ä½•ä½¿ç”¨å½“å‰å®ç°

```python
from strategies.position.market_analyzers.us_market_analyzer import USMarketAnalyzer

# åˆå§‹åŒ–åˆ†æå™¨
analyzer = USMarketAnalyzer()

# è¿è¡Œåˆ†æ
result = analyzer.analyze_single_index('SPX')

# æŸ¥çœ‹Phase 3.3æŒ‡æ ‡
phase3 = result.get('phase3_analysis', {})

# ä¼°å€¼åˆ†æ
if 'valuation' in phase3:
    val = phase3['valuation']
    if 'error' in val:
        print(f"ä¼°å€¼åˆ†æ: {val['note']}")  # æç¤ºä½¿ç”¨ä»·æ ¼ä»£ç†
    else:
        print(f"ä¼°å€¼æ°´å¹³: {val['valuation_level']}")

# å¸‚åœºå®½åº¦
if 'market_breadth' in phase3:
    breadth = phase3['market_breadth']
    if 'error' in breadth:
        print(f"å¸‚åœºå®½åº¦: {breadth['message']}")  # æç¤ºéœ€è¦æ•°æ®æº
        print(f"ä¸´æ—¶æ–¹æ¡ˆ: {breadth['workaround']}")

# èèµ„åˆ†æ
if 'margin_trading' in phase3:
    margin = phase3['margin_trading']
    if 'error' in margin:
        print(f"èèµ„åˆ†æ: {margin['message']}")  # æç¤ºéœ€è¦FINRAæ•°æ®
        print(f"ä¸´æ—¶æ–¹æ¡ˆ: {margin['workaround']['method']}")
```

---

## ğŸ“š å‚è€ƒèµ„æº

### æ•°æ®æºæ–‡æ¡£

- **Shiller PE**: http://www.econ.yale.edu/~shiller/data.htm
- **FINRA Margin**: https://www.finra.org/investors/learn-to-invest/advanced-investing/margin-statistics
- **Alpha Vantage**: https://www.alphavantage.co/documentation/
- **IEX Cloud**: https://iexcloud.io/docs/api/
- **yfinance**: https://github.com/ranaroussi/yfinance

### ç›¸å…³è®ºæ–‡

- Shiller, R. J. (2005). *Irrational Exuberance*
- Zweig, M. E. (2010). *Understanding Market Breadth*

---

## â“ å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆç¾è‚¡ä¸èƒ½åƒAè‚¡ä¸€æ ·å®Œæ•´å®ç°ï¼Ÿ**

A: å› ä¸ºæ•°æ®æºé™åˆ¶ã€‚akshareå¯¹Aè‚¡æ”¯æŒå®Œå–„ï¼Œä½†ç¾è‚¡çš„ä¸“ä¸šæ•°æ®éœ€è¦ä»˜è´¹æœåŠ¡æˆ–é¢å¤–å¼€å‘ã€‚

**Q: éœ€è¦ç«‹å³æ¥å…¥ä»˜è´¹æ•°æ®æºå—ï¼Ÿ**

A: ä¸éœ€è¦ã€‚å½“å‰çš„è¿‘ä¼¼æ–¹æ¡ˆï¼ˆä»·æ ¼ä»£ç†ã€VIXæƒ…ç»ªï¼‰å¯ä»¥æä¾›å‚è€ƒä»·å€¼ã€‚å¦‚æœéœ€è¦æ›´ç²¾å‡†åˆ†æï¼Œå†è€ƒè™‘ä»˜è´¹æœåŠ¡ã€‚

**Q: æ¸¯è‚¡ä»€ä¹ˆæ—¶å€™æ”¯æŒï¼Ÿ**

A: å–å†³äºéœ€æ±‚ä¼˜å…ˆçº§ã€‚å»ºè®®å…ˆå®Œå–„ç¾è‚¡ï¼Œå†è€ƒè™‘æ¸¯è‚¡ã€‚

---

**æœ€åæ›´æ–°**: 2025-10-28
