# GitHub Actions è‡ªåŠ¨ç›‘æŽ§é…ç½®æŒ‡å—

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•ä½¿ç”¨ GitHub Actions å®žçŽ°æ¯æ—¥è‡ªåŠ¨ç›‘æŽ§ï¼Œæ— éœ€æœ¬åœ°ç”µè„‘å¼€æœºã€‚

## ðŸ“‹ å‰ææ¡ä»¶

- âœ… ä»£ç å·²æŽ¨é€åˆ° GitHubï¼ˆprivate ä»“åº“ä¹Ÿå¯ä»¥ï¼‰
- âœ… æœ‰ QQ é‚®ç®±æˆ–å…¶ä»–é‚®ç®±çš„æŽˆæƒç 

## ðŸš€ é…ç½®æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šé…ç½® GitHub Secrets

åœ¨ä½ çš„ GitHub ä»“åº“é¡µé¢ï¼š

1. ç‚¹å‡» **Settings** (è®¾ç½®)
2. å·¦ä¾§èœå•æ‰¾åˆ° **Secrets and variables** â†’ **Actions**
3. ç‚¹å‡» **New repository secret** æŒ‰é’®

ä¾æ¬¡æ·»åŠ ä»¥ä¸‹ 6 ä¸ª Secretsï¼š

| Secret åç§° | å€¼ | è¯´æ˜Ž |
|------------|-----|------|
| `SMTP_SERVER` | `smtp.qq.com` | SMTP æœåŠ¡å™¨åœ°å€ |
| `SMTP_PORT` | `465` | SMTP ç«¯å£ |
| `SENDER_EMAIL` | `1264947688@qq.com` | ä½ çš„å‘ä»¶é‚®ç®± |
| `SENDER_PASSWORD` | `swdfhpryoztsgfei` | é‚®ç®±æŽˆæƒç  |
| `SENDER_NAME` | `è‚¡ç¥¨ç›‘æŽ§ç³»ç»Ÿ` | å‘ä»¶äººåç§° |
| `RECIPIENT_EMAIL` | `1264947688@qq.com` | æ”¶ä»¶é‚®ç®± |

**æ·»åŠ æ–¹æ³•**ï¼š
1. ç‚¹å‡» **New repository secret**
2. **Name**: è¾“å…¥ Secret åç§°ï¼ˆå¦‚ `SMTP_SERVER`ï¼‰
3. **Secret**: è¾“å…¥å¯¹åº”çš„å€¼ï¼ˆå¦‚ `smtp.qq.com`ï¼‰
4. ç‚¹å‡» **Add secret**
5. é‡å¤ä»¥ä¸Šæ­¥éª¤ï¼Œæ·»åŠ å…¨éƒ¨ 6 ä¸ª Secrets

### ç¬¬äºŒæ­¥ï¼šæäº¤ä»£ç åˆ° GitHub

```bash
# æ·»åŠ  GitHub Actions é…ç½®æ–‡ä»¶
git add .github/workflows/ma_deviation_monitor.yml

# æäº¤
git commit -m "feat: æ·»åŠ  GitHub Actions è‡ªåŠ¨ç›‘æŽ§é…ç½®"

# æŽ¨é€åˆ° GitHub
git push
```

### ç¬¬ä¸‰æ­¥ï¼šå¯ç”¨ GitHub Actions

1. è¿›å…¥ä½ çš„ GitHub ä»“åº“é¡µé¢
2. ç‚¹å‡»é¡¶éƒ¨çš„ **Actions** æ ‡ç­¾
3. å¦‚æžœçœ‹åˆ°æç¤ºéœ€è¦å¯ç”¨ Actionsï¼Œç‚¹å‡» **I understand my workflows, go ahead and enable them**

### ç¬¬å››æ­¥ï¼šæ‰‹åŠ¨æµ‹è¯•è¿è¡Œ

é¦–æ¬¡é…ç½®å»ºè®®æ‰‹åŠ¨æµ‹è¯•ï¼š

1. è¿›å…¥ **Actions** æ ‡ç­¾
2. å·¦ä¾§é€‰æ‹© **å‡çº¿åç¦»åº¦ç›‘æŽ§** å·¥ä½œæµ
3. ç‚¹å‡»å³ä¸Šè§’ **Run workflow** ä¸‹æ‹‰èœå•
4. ç‚¹å‡»ç»¿è‰²çš„ **Run workflow** æŒ‰é’®

ç­‰å¾… 1-2 åˆ†é’Ÿï¼ŒæŸ¥çœ‹è¿è¡Œç»“æžœï¼š
- âœ… ç»¿è‰²å¯¹å‹¾ï¼šè¿è¡ŒæˆåŠŸï¼Œæ£€æŸ¥é‚®ç®±æ˜¯å¦æ”¶åˆ°é‚®ä»¶
- âŒ çº¢è‰²å‰ï¼šè¿è¡Œå¤±è´¥ï¼Œç‚¹å‡»æŸ¥çœ‹æ—¥å¿—

## ðŸ“… è‡ªåŠ¨æ‰§è¡Œæ—¶é—´

é…ç½®å®ŒæˆåŽï¼Œç³»ç»Ÿä¼šåœ¨ä»¥ä¸‹æ—¶é—´è‡ªåŠ¨è¿è¡Œï¼š

- **æ¯å‘¨ä¸€åˆ°å‘¨äº”** ä¸‹åˆ **15:10** (åŒ—äº¬æ—¶é—´)
- Aè‚¡æ”¶ç›˜åŽ 10 åˆ†é’Ÿï¼Œç¡®ä¿æ•°æ®å·²æ›´æ–°

**ä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªæ—¶é—´ï¼Ÿ**
- Aè‚¡æ”¶ç›˜æ—¶é—´ï¼š15:00
- ç•™ 10 åˆ†é’Ÿç»™æ•°æ®æºæ›´æ–°æ•°æ®
- ç¡®ä¿ç›‘æŽ§çš„æ˜¯å½“å¤©æ”¶ç›˜æ•°æ®

## ðŸ” æŸ¥çœ‹è¿è¡ŒåŽ†å²

1. è¿›å…¥ **Actions** æ ‡ç­¾
2. å·¦ä¾§é€‰æ‹© **å‡çº¿åç¦»åº¦ç›‘æŽ§**
3. æŸ¥çœ‹åŽ†å²è¿è¡Œè®°å½•
4. ç‚¹å‡»ä»»æ„ä¸€æ¬¡è¿è¡Œï¼Œå¯ä»¥æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

## âš™ï¸ é«˜çº§é…ç½®

### ä¿®æ”¹æ‰§è¡Œæ—¶é—´

ç¼–è¾‘ `.github/workflows/ma_deviation_monitor.yml`ï¼š

```yaml
on:
  schedule:
    # ä¿®æ”¹è¿™é‡Œçš„æ—¶é—´
    # æ ¼å¼: 'MM HH * * 1-5'
    # MM: åˆ†é’Ÿ (0-59)
    # HH: å°æ—¶ (0-23, UTCæ—¶é—´ï¼Œéœ€è¦å‡8å°æ—¶)

    # ç¤ºä¾‹ï¼š
    # åŒ—äº¬æ—¶é—´ 15:10 = UTC 07:10
    - cron: '10 7 * * 1-5'

    # åŒ—äº¬æ—¶é—´ 16:10 (æ¸¯è‚¡æ”¶ç›˜åŽ) = UTC 08:10
    # - cron: '10 8 * * 1-5'
```

**æ—¶åŒºè½¬æ¢**ï¼š
- GitHub Actions ä½¿ç”¨ UTC æ—¶é—´
- åŒ—äº¬æ—¶é—´ = UTC + 8
- ä¾‹ï¼šåŒ—äº¬æ—¶é—´ 15:00 â†’ UTC 07:00

### åŒæ—¶ç›‘æŽ§Aè‚¡å’Œæ¸¯è‚¡æ”¶ç›˜

```yaml
on:
  schedule:
    # Aè‚¡æ”¶ç›˜åŽ (15:10)
    - cron: '10 7 * * 1-5'
    # æ¸¯è‚¡æ”¶ç›˜åŽ (16:10)
    - cron: '10 8 * * 1-5'
```

### å¢žåŠ é‡è¯•æ¬¡æ•°

ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ `--retry` å‚æ•°ï¼š

```yaml
- name: è¿è¡Œç›‘æŽ§å¹¶å‘é€é‚®ä»¶
  run: |
    python scripts/position_analysis/run_ma_deviation_monitor.py --email --quiet --retry 5
```

### æ·»åŠ å¤šä¸ªæ”¶ä»¶äºº

ä¿®æ”¹ Secret `RECIPIENT_EMAIL`ï¼š

```yaml
# åœ¨ GitHub Secrets ä¸­ï¼ŒRECIPIENT_EMAIL å¡«å†™ï¼š
1264947688@qq.com,another@example.com
```

æˆ–è€…ç›´æŽ¥ä¿®æ”¹ workflow é…ç½®ï¼š

```yaml
- name: åˆ›å»ºé‚®ç®±é…ç½®æ–‡ä»¶
  run: |
    cat > email_config.yaml << EOF
    smtp:
      server: ${{ secrets.SMTP_SERVER }}
      port: ${{ secrets.SMTP_PORT }}

    sender:
      email: ${{ secrets.SENDER_EMAIL }}
      password: ${{ secrets.SENDER_PASSWORD }}
      name: ${{ secrets.SENDER_NAME }}

    recipients:
      - ${{ secrets.RECIPIENT_EMAIL }}
      - user2@example.com
      - user3@example.com

    send_no_alert_email: false
    EOF
```

## ðŸ› ï¸ æ•…éšœæŽ’æŸ¥

### é—®é¢˜1ï¼šæ²¡æœ‰æ”¶åˆ°é‚®ä»¶

**æ£€æŸ¥æ­¥éª¤**ï¼š
1. è¿›å…¥ **Actions** æŸ¥çœ‹è¿è¡Œæ˜¯å¦æˆåŠŸï¼ˆç»¿è‰²å¯¹å‹¾ï¼‰
2. ç‚¹å‡»è¿è¡Œè®°å½•ï¼ŒæŸ¥çœ‹ **è¿è¡Œç›‘æŽ§å¹¶å‘é€é‚®ä»¶** æ­¥éª¤çš„æ—¥å¿—
3. æŸ¥æ‰¾ `âœ… é¢„è­¦é‚®ä»¶å‘é€æˆåŠŸ` æˆ–é”™è¯¯ä¿¡æ¯

**å¸¸è§åŽŸå› **ï¼š
- Secrets é…ç½®é”™è¯¯ï¼ˆé‚®ç®±æŽˆæƒç ä¸æ­£ç¡®ï¼‰
- é‚®ç®±æœåŠ¡å•†é™åˆ¶ï¼ˆQQé‚®ç®±æ¯å¤©å‘é€é™åˆ¶ï¼‰
- ä»Šæ—¥æ— é¢„è­¦ä¸”æœªå¼€å¯ `send_no_alert_email`

### é—®é¢˜2ï¼šActions è¿è¡Œå¤±è´¥

1. ç‚¹å‡»å¤±è´¥çš„è¿è¡Œè®°å½•
2. å±•å¼€çº¢è‰²çš„æ­¥éª¤
3. æŸ¥çœ‹é”™è¯¯æ—¥å¿—

**å¸¸è§é”™è¯¯**ï¼š
- `secrets.SMTP_SERVER not found` â†’ Secrets æœªé…ç½®
- `ModuleNotFoundError` â†’ ä¾èµ–å®‰è£…å¤±è´¥ï¼ˆæ£€æŸ¥ requirements.txtï¼‰
- `Connection refused` â†’ ç½‘ç»œé—®é¢˜æˆ– SMTP æœåŠ¡å™¨ä¸å¯è¾¾

### é—®é¢˜3ï¼šæ—¶é—´ä¸å¯¹

GitHub Actions ä½¿ç”¨ UTC æ—¶é—´ï¼Œéœ€è¦æ‰‹åŠ¨è½¬æ¢ï¼š
- åŒ—äº¬æ—¶é—´ 15:10 â†’ cron: `'10 7 * * 1-5'`
- åŒ—äº¬æ—¶é—´ 16:10 â†’ cron: `'10 8 * * 1-5'`

## ðŸ’° è´¹ç”¨è¯´æ˜Ž

GitHub Actions å¯¹ private ä»“åº“çš„å…è´¹é¢åº¦ï¼š

- **å…è´¹é¢åº¦**ï¼šæ¯æœˆ 2000 åˆ†é’Ÿ
- **æœ¬ç›‘æŽ§æ¶ˆè€—**ï¼šæ¯æ¬¡çº¦ 1-2 åˆ†é’Ÿ
- **æ¯æœˆæ‰§è¡Œæ¬¡æ•°**ï¼šçº¦ 20 æ¬¡ (æ¯æœˆå·¥ä½œæ—¥)
- **å®žé™…æ¶ˆè€—**ï¼šçº¦ 40 åˆ†é’Ÿ/æœˆ

**ç»“è®º**ï¼šå®Œå…¨åœ¨å…è´¹é¢åº¦å†…ï¼Œæ— éœ€ä»˜è´¹ï¼

## ðŸ”’ å®‰å…¨è¯´æ˜Ž

### Secrets å®‰å…¨æ€§

- âœ… Secrets åœ¨ GitHub ä¸­åŠ å¯†å­˜å‚¨
- âœ… æ—¥å¿—ä¸­ä¸ä¼šæ˜¾ç¤º Secrets å†…å®¹
- âœ… åªæœ‰ä»“åº“ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹/ä¿®æ”¹ Secrets
- âš ï¸ å»ºè®®å®šæœŸæ›´æ¢é‚®ç®±æŽˆæƒç 

### ç§æœ‰ä»“åº“ä¼˜åŠ¿

- âœ… ä»£ç ä¸å…¬å¼€
- âœ… é…ç½®ä¸å…¬å¼€
- âœ… åªæœ‰ä½ èƒ½çœ‹åˆ° Actions è¿è¡Œè®°å½•

## ðŸ“Š è¿è¡Œç¤ºä¾‹

æˆåŠŸè¿è¡Œçš„æ—¥å¿—ç¤ºä¾‹ï¼š

```
Run python scripts/position_analysis/run_ma_deviation_monitor.py --email --quiet --retry 5
INFO:__main__:å¼€å§‹ç›‘æŽ§ (ç¬¬ 1/3 æ¬¡å°è¯•)
INFO:position_analysis.ma_deviation_monitor:å‡çº¿åç¦»åº¦ç›‘æŽ§å™¨åˆå§‹åŒ–å®Œæˆ
INFO:position_analysis.ma_deviation_monitor:èŽ·å– ä¸Šè¯æŒ‡æ•° åŽ†å²æ•°æ®...
INFO:position_analysis.ma_deviation_monitor:ä¸Šè¯æŒ‡æ•° æ•°æ®èŽ·å–æˆåŠŸ: 8497 æ¡
...
INFO:__main__:å‘é€é¢„è­¦é‚®ä»¶: 5 ä¸ªä¿¡å·
INFO:position_analysis.email_notifier:é‚®ä»¶å‘é€æˆåŠŸ
INFO:__main__:âœ… é¢„è­¦é‚®ä»¶å‘é€æˆåŠŸ
```

## ðŸŽ¯ æœ€ä½³å®žè·µ

1. **é¦–æ¬¡é…ç½®åŽç«‹å³æ‰‹åŠ¨æµ‹è¯•**ï¼Œç¡®ä¿èƒ½æ”¶åˆ°é‚®ä»¶
2. **å®šæœŸæ£€æŸ¥ Actions è¿è¡Œè®°å½•**ï¼Œç¡®ä¿æ²¡æœ‰å¤±è´¥
3. **æ¯3-6ä¸ªæœˆæ›´æ¢é‚®ç®±æŽˆæƒç **ï¼Œä¿éšœå®‰å…¨
4. **å…³æ³¨é‚®ä»¶å†…å®¹**ï¼ŒåŠæ—¶è°ƒæ•´æŠ•èµ„ç­–ç•¥

## ðŸ“š ç›¸å…³æ–‡æ¡£

- [GitHub Actions å®˜æ–¹æ–‡æ¡£](https://docs.github.com/en/actions)
- [å®šæ—¶ä»»åŠ¡é…ç½®æŒ‡å—](./å®šæ—¶ä»»åŠ¡é…ç½®æŒ‡å—.md) - æœ¬åœ° cron æ–¹æ¡ˆ
- [å‡çº¿åç¦»åº¦ç›‘æŽ§ç³»ç»Ÿ](./å‡çº¿åç¦»åº¦ç›‘æŽ§ç³»ç»Ÿ.md) - ç³»ç»Ÿè¯´æ˜Ž

## â“ å¸¸è§é—®é¢˜

### æ‰§è¡Œæ—¶é—´ç›¸å…³

**Q: ä¼šè‡ªåŠ¨æ‰§è¡Œå—ï¼Ÿå‡ ç‚¹æ‰§è¡Œï¼Ÿ**
A: ä¼šï¼æ¯å‘¨ä¸€åˆ°å‘¨äº”ä¸‹åˆ **15:10**ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰è‡ªåŠ¨æ‰§è¡Œã€‚

**Q: æ‰§è¡Œæ—¶é—´å‡†ç¡®å—ï¼Ÿ**
A: GitHub Actions è°ƒåº¦å¯èƒ½æœ‰ **5-15åˆ†é’Ÿå»¶è¿Ÿ**ã€‚è®¾ç½®15:10å¯èƒ½15:15-15:25æ‰æ‰§è¡Œï¼Œä½†å¯¹è‚¡ç¥¨ç›‘æŽ§æ¥è¯´å®Œå…¨å¤Ÿç”¨ã€‚

**Q: å‘¨æœ«ä¼šæ‰§è¡Œå—ï¼Ÿ**
A: ä¸ä¼šï¼Œé…ç½®ä¸­ä½¿ç”¨ `1-5` é™å®šä¸ºå‘¨ä¸€åˆ°å‘¨äº”ã€‚

**Q: å›½åº†/æ˜¥èŠ‚ç­‰å‡æœŸä¼šæ‰§è¡Œå—ï¼Ÿ**
A: ä¼šæ‰§è¡Œï¼Œå› ä¸º GitHub Actions æ— æ³•è¯†åˆ«ä¸­å›½æ³•å®šå‡æœŸã€‚ä½†å› ä¸ºæ˜¯å‡æœŸï¼Œæ•°æ®æºä¸ä¼šæ›´æ–°ï¼ŒèŽ·å–çš„è¿˜æ˜¯æœ€åŽä¸€ä¸ªäº¤æ˜“æ—¥çš„æ•°æ®ã€‚ä¸å½±å“ä½¿ç”¨ã€‚

**Q: å¯ä»¥æ”¹æˆå…¶ä»–æ—¶é—´å—ï¼Ÿ**
A: å¯ä»¥ï¼ä¿®æ”¹ `.github/workflows/ma_deviation_monitor.yml` ä¸­çš„ cron è¡¨è¾¾å¼ã€‚

**Q: å¯ä»¥ä¸€å¤©æ‰§è¡Œä¸¤æ¬¡å—ï¼ˆAè‚¡+æ¸¯è‚¡æ”¶ç›˜åŽå„ä¸€æ¬¡ï¼‰ï¼Ÿ**
A: å¯ä»¥ï¼æ·»åŠ ä¸¤ä¸ª cron æ—¶é—´ï¼š
```yaml
schedule:
  - cron: '10 7 * * 1-5'  # 15:10 Aè‚¡æ”¶ç›˜åŽ
  - cron: '10 8 * * 1-5'  # 16:10 æ¸¯è‚¡æ”¶ç›˜åŽ
```

### æ“ä½œç›¸å…³

**Q: å¯ä»¥æš‚åœå—ï¼Ÿ**
A: å¯ä»¥ï¼Œè¿›å…¥ Actions â†’ é€‰æ‹©å·¥ä½œæµ â†’ å³ä¸Šè§’ `...` â†’ Disable workflow

**Q: å¯ä»¥ç«‹å³æ‰‹åŠ¨æ‰§è¡Œä¸€æ¬¡å—ï¼Ÿ**
A: å¯ä»¥ï¼Œè¿›å…¥ Actions â†’ é€‰æ‹©å·¥ä½œæµ â†’ Run workflow

**Q: å¦‚ä½•æŸ¥çœ‹è¿è¡ŒåŽ†å²ï¼Ÿ**
A: è¿›å…¥ä»“åº“çš„ Actions æ ‡ç­¾ï¼Œé€‰æ‹©"å‡çº¿åç¦»åº¦ç›‘æŽ§"å·¥ä½œæµï¼ŒæŸ¥çœ‹åŽ†å²è®°å½•ã€‚

### æŠ€æœ¯ç»†èŠ‚

**Q: cron è¡¨è¾¾å¼æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ**
A: cron æ˜¯ Linux å®šæ—¶ä»»åŠ¡çš„æ ‡å‡†æ ¼å¼ï¼š
```
'10 7 * * 1-5'
 â”‚  â”‚ â”‚ â”‚ â”‚
 â”‚  â”‚ â”‚ â”‚ â””â”€ å‘¨ä¸€åˆ°å‘¨äº” (1=å‘¨ä¸€, 5=å‘¨äº”)
 â”‚  â”‚ â”‚ â””â”€â”€â”€ æ¯æœˆ
 â”‚  â”‚ â””â”€â”€â”€â”€â”€ æ¯æ—¥
 â”‚  â””â”€â”€â”€â”€â”€â”€â”€ 7ç‚¹ (UTCæ—¶é—´)
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 10åˆ†
```

**Q: ä¸ºä»€ä¹ˆ cron æ˜¯ 7 ç‚¹ï¼Œå®žé™…æ˜¯ 15:10ï¼Ÿ**
A: GitHub Actions ä½¿ç”¨ **UTC æ—¶é—´**ï¼ˆä¸–ç•Œæ ‡å‡†æ—¶é—´ï¼‰ï¼ŒåŒ—äº¬æ—¶é—´ = UTC + 8 å°æ—¶ã€‚
- UTC 07:10 = åŒ—äº¬æ—¶é—´ 15:10

**Q: è™šæ‹Ÿæœºè¿è¡Œå®Œä¼šä¿ç•™æ•°æ®å—ï¼Ÿ**
A: ä¸ä¼šã€‚æ¯æ¬¡è¿è¡Œéƒ½æ˜¯å…¨æ–°çš„ Ubuntu è™šæ‹Ÿæœºï¼Œè¿è¡Œå®Œç«‹å³é”€æ¯ã€‚æ•°æ®æ¯æ¬¡éƒ½é‡æ–°ä¸‹è½½ã€‚

**Q: ä¸ºä»€ä¹ˆè¦å®‰è£… TA-Lib C åº“ï¼Ÿ**
A: TA-Lib æ˜¯æŠ€æœ¯åˆ†æžåº“ï¼ŒPython åŒ…ä¾èµ–äºŽ C åº“ã€‚Ubuntu ä¸Šéœ€è¦å…ˆç¼–è¯‘å®‰è£… C åº“ï¼Œæ‰èƒ½å®‰è£… Python åŒ…ã€‚

## âœ… é…ç½®æ£€æŸ¥æ¸…å•

é…ç½®å®ŒæˆåŽï¼Œè¯·ç¡®è®¤ï¼š

- [ ] 6 ä¸ª Secrets å·²å…¨éƒ¨æ·»åŠ 
- [ ] GitHub Actions å·²å¯ç”¨
- [ ] æ‰‹åŠ¨è¿è¡Œæµ‹è¯•æˆåŠŸ
- [ ] æ”¶åˆ°æµ‹è¯•é‚®ä»¶
- [ ] æ£€æŸ¥é‚®ä»¶å†…å®¹æ ¼å¼æ­£å¸¸
- [ ] äº†è§£æ¯å¤©æ‰§è¡Œæ—¶é—´ (15:10)
- [ ] çŸ¥é“å¦‚ä½•æŸ¥çœ‹è¿è¡ŒåŽ†å²

å…¨éƒ¨å®ŒæˆåŽï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è¿è¡Œï¼Œæ— éœ€å¹²é¢„ï¼
