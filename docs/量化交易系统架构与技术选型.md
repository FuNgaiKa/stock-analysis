# 量化交易系统架构与技术选型指南

## 文档目的

本文档旨在帮助个人量化投资者理解：
1. 量化交易系统的完整架构
2. 不同编程语言（Python/Go/Java）在金融数据领域的优劣势
3. 如何根据自身需求选择合适的技术栈
4. 何时需要升级技术架构

---

## 一、量化交易系统的三层架构

典型的量化交易系统分为三个层次，每层有不同的职责和性能要求：

### 1.1 研究层（Research Layer）

#### 职责
- 数据探索和清洗
- 因子挖掘和特征工程
- 策略开发和回测
- 模型训练和优化
- 生成分析报告

#### 技术特点
- **数据类型**：历史数据（静态）
- **时间要求**：不敏感，可以跑几小时甚至几天
- **开发效率**：要求高，需要快速验证想法
- **推荐技术栈**：Python

#### 典型工具
```python
# 数据获取
import akshare as ak
import yfinance as yf

# 数据处理
import pandas as pd
import numpy as np

# 回测框架
import backtrader
import vectorbt

# 可视化
import matplotlib.pyplot as plt
import plotly
```

#### 示例代码
```python
# 获取历史数据
df = ak.stock_zh_a_hist(
    symbol="000001",
    start_date="20240101",
    end_date="20241231"
)

# 计算技术指标
df['ma5'] = df['收盘'].rolling(5).mean()
df['ma10'] = df['收盘'].rolling(10).mean()

# 回测策略
for i in range(len(df)):
    if df['ma5'][i] > df['ma10'][i]:
        # 产生买入信号
        pass
```

---

### 1.2 策略层（Strategy Layer）

#### 职责
- **接收实时行情数据**（核心差异）
- 运行策略逻辑（计算信号）
- 生成交易指令
- 风险管理和仓位控制

#### 技术特点
- **数据类型**：实时行情（流式数据）
- **时间要求**：秒级到分钟级（取决于策略频率）
- **运行方式**：常驻进程，持续监听
- **推荐技术栈**：Python/Java 都可以

#### 研究层 vs 策略层对比

| 维度 | 研究层（回测） | 策略层（实盘） |
|------|---------------|---------------|
| **数据来源** | 历史数据（静态） | 实时行情（流式） |
| **数据获取** | `akshare.stock_zh_a_hist()` | WebSocket/行情推送 |
| **运行方式** | 一次性跑完 | 常驻进程，持续监听 |
| **时间概念** | 回放历史（事后诸葛亮） | 真实时钟（只知道当前） |
| **输出** | 回测报告 | 真实交易指令 |
| **风险** | 无风险 | 真金白银 |

#### 实时行情数据源

| 数据源 | 免费/付费 | 延迟 | 适用场景 |
|-------|---------|------|---------|
| **新浪财经** | 免费 | 3-5秒 | 日内低频策略 |
| **东方财富** | 免费 | 3-5秒 | 个人学习 |
| **TuShare Pro** | 需积分 | 1-3秒 | 分钟级策略 |
| **AkShare实时接口** | 免费 | 3-5秒 | 个人量化 |
| **券商Level-1** | 付费 | 1秒 | 专业交易 |
| **券商Level-2** | 付费 | <500ms | 高频交易 |
| **交易所直连** | 付费+资质 | <10ms | 机构专用 |

#### 示例代码（实时监控）
```python
import akshare as ak
import time

def real_time_monitor():
    """实时监控策略示例"""
    while True:
        # 获取实时行情
        df_spot = ak.stock_zh_a_spot_em()

        # 计算信号（简化示例）
        for _, stock in df_spot.iterrows():
            if stock['涨跌幅'] > 5:  # 涨幅超过5%
                send_alert(stock['代码'], stock['名称'])

        # 等待下一次检查
        time.sleep(60)  # 每分钟检查一次
```

---

### 1.3 执行层（Execution Layer）

#### 职责
- 接收交易指令（买/卖什么、多少量、什么价格）
- **智能拆单**：把大单拆成小单，避免冲击市场
- **智能路由**：选择最优的交易所/券商通道
- **订单管理**：
  - 下单、撤单、改单
  - 监控成交状态
  - 处理部分成交、拒单等异常
- **延迟优化**：
  - 与交易所建立专线
  - 减少网络跳转
  - 优化数据序列化

#### 技术特点
- **时间要求**：**微秒级**（1微秒 = 0.001毫秒）
- **推荐技术栈**：C++/Java/Go
- **极致优化**：
  - 服务器托管在交易所机房旁边
  - 使用专线网络
  - 甚至使用FPGA硬件加速

#### 为什么需要高性能？

**套利场景举例：**
```
茅台在上海交易所 1800.00元
茅台在深圳交易所 1800.50元
价差0.50元的机会可能只存在几毫秒！
```

**性能对比：**
- **Python执行层**（5ms延迟）：等你下单时，价格已经被别人套平
- **C++执行层**（0.1ms延迟）：能抢在别人之前完成交易

---

## 二、不同策略对技术栈的要求

| 策略类型 | 信号频率 | 执行层要求 | 适用语言 | 是否需要实时行情 |
|---------|---------|-----------|---------|----------------|
| **日线策略** | 每天1次 | 低（秒级） | Python完全够 | ❌ 历史数据即可 |
| **持仓分析** | 定期分析 | 无 | Python | ❌ 历史数据即可 |
| **分钟线策略** | 每分钟 | 中等（秒级） | Python/Java | ✅ 需要 |
| **秒级策略** | 每秒多次 | 高（毫秒级） | Java/Go | ✅ 需要 |
| **高频套利** | 每秒几百次 | 极高（微秒级） | C++/FPGA | ✅ 需要 |

---

## 三、编程语言在金融数据领域的对比

### 3.1 Python

#### 优势
✅ **生态最成熟**
- 专门为中国市场设计的数据库：AkShare、TuShare
- 完整的量化工具链：pandas、numpy、backtrader、vnpy
- 大量中文文档和社区支持

✅ **开箱即用**
```bash
pip install akshare  # 无需注册、无需token
```

✅ **开发效率高**
- Jupyter Notebook适合探索性分析
- 代码简洁，调试方便

✅ **数据覆盖广**
- A股、港股、美股、期货、期权、基金、债券、外汇、宏观经济
- 直接爬取/对接中国各大财经网站

#### 劣势
❌ 执行速度慢（不适合高频交易）
❌ GIL限制（多线程性能受限）

#### 适用场景
- ✅ 个人量化研究
- ✅ 策略回测
- ✅ 低频交易（日线、分钟线）
- ✅ 持仓分析
- ❌ 高频交易

---

### 3.2 Go语言

#### 金融数据SDK

**国际市场：**
1. **finance-go** (piquette/finance-go)
   - 从Yahoo Finance获取数据
   - 支持股票、期权、图表

2. **商业API的Go SDK**
   - Polygon.io
   - Market Data API
   - Alpaca
   - Twelve Data

**中国市场：**
1. **tushare-go** (ShawnRong/tushare-go)
   - TuShare的Go版本
   - ⚠️ 仍需注册TuShare账号、获取token、管理积分

2. **investool** (axiaoxin-com/investool)
   - 支持财报分析、个股基本面检测
   - 数据源：东方财富网、新浪财经

3. **go-stock** (ArvinLovegood/go-stock)
   - 支持A股、港股、美股
   - 集成AI分析功能

#### 优势
✅ 高性能、低延迟
✅ 并发支持好（goroutine）
✅ 部署简单（编译成单一可执行文件）

#### 劣势
❌ **没有AkShare原生SDK**（需通过HTTP API调用）
❌ 中国市场数据获取不如Python方便
❌ 量化分析库不如Python丰富

#### 适用场景
- ✅ 高性能交易执行层
- ✅ 实时行情处理
- ✅ 微服务架构
- ❌ 策略研究和回测

---

### 3.3 Java

#### 金融数据SDK

**国际市场：**
1. **yahoofinance-api** (sstrickx)
   - Yahoo Finance的Java客户端
   - 支持股票、外汇数据

2. **YFinance4J** (tekichan)
   - 模仿Python的yfinance设计
   - 使用Java 17特性

3. **Jfinance** (hitzseb)
   - 受Python yfinance启发
   - API设计简洁

**中国市场：**
- ⚠️ 同样没有原生AkShare SDK
- 需要通过TuShare Pro的HTTP API调用

#### 优势
✅ 性能好（仅次于C++）
✅ 企业级应用成熟
✅ 券商接口通常提供Java SDK

#### 劣势
❌ 开发效率低于Python
❌ 数据获取不如Python方便
❌ 量化研究工具少

#### 适用场景
- ✅ 企业级量化系统
- ✅ 对接券商接口
- ✅ 策略层+执行层
- ❌ 个人快速研究

---

## 四、技术选型建议

### 4.1 个人量化分析（当前阶段）

**推荐方案：Python + AkShare**

✅ **为什么这是最优选择？**

1. **完全免费**
   - AkShare无需注册、无需token
   - TuShare Pro需要积分（做任务或付费）

2. **学习曲线平缓**
   - Python + pandas + numpy 是量化分析的标准栈
   - 大量的量化策略示例都是Python
   - 丰富的中文教程和社区

3. **开发效率高**
   - 个人项目不需要考虑高并发、微秒级延迟
   - Python快速验证想法
   - Jupyter Notebook适合探索

4. **生态完整**
   ```
   数据获取：AkShare, yfinance
   数据处理：pandas, numpy
   回测框架：backtrader, vnpy, qlib
   可视化：matplotlib, plotly, pyecharts
   机器学习：sklearn, xgboost, pytorch
   ```

**你的项目架构已经很合理：**
```
stock-analysis/
├── position_analysis/     # Python数据分析（发挥其优势）
├── frontend/             # 前端可视化展示
└── reports/              # 生成HTML报告
```

---

### 4.2 何时考虑Go/Java？

只有在以下场景才值得切换：

#### 场景1：进入实盘交易
- 需要毫秒级响应
- 需要对接券商接口（通常提供C++/Java SDK）
- 策略频率：秒级或更高

#### 场景2：构建商业系统
- 多用户、高并发
- 需要微服务架构
- 需要企业级可靠性

#### 场景3：公司/团队要求
- 技术栈统一
- 有专门的运维团队
- 代码需要长期维护

---

### 4.3 典型的混合架构

很多量化团队采用分层技术栈：

```
┌──────────────────────┐
│   研究层 (Python)     │  策略师用Jupyter做研究
│   - 数据探索         │  使用AkShare获取历史数据
│   - 策略回测         │  pandas/numpy处理数据
│   - 参数优化         │  backtrader回测
└──────────┬───────────┘
           │ 策略代码导出
           ↓
┌──────────────────────┐
│  策略层 (Python/Java) │  接收实时行情，计算信号
│   - 实时行情监控      │  WebSocket接收tick数据
│   - 信号生成         │  运行策略逻辑
│   - 风险控制         │  仓位管理、止损止盈
└──────────┬───────────┘
           │ 交易指令（JSON/RPC）
           ↓
┌──────────────────────┐
│  执行层 (C++/Go)      │  极致性能，处理订单
│   - 智能拆单         │  大单拆小单
│   - 订单路由         │  选择最优通道
│   - 订单管理         │  下单/撤单/改单
│   - 成交回报         │  处理成交和异常
└──────────────────────┘
```

**各层职责清晰，技术栈最优。**

---

## 五、AkShare vs TuShare vs 商业API

### 5.1 数据源对比

| 数据源 | 免费程度 | 注册要求 | 数据质量 | 适用场景 |
|-------|---------|---------|---------|---------|
| **AkShare** | ✅ 完全免费 | ❌ 无需注册 | ⭐⭐⭐⭐ | 个人研究 |
| **TuShare** | ⚠️ 老版免费<br>Pro需积分 | ✅ 需要注册 | ⭐⭐⭐⭐⭐ | 专业量化 |
| **yfinance** | ✅ 完全免费 | ❌ 无需注册 | ⭐⭐⭐⭐ | 国际市场 |
| **Wind** | ❌ 付费（贵） | ✅ 需要合同 | ⭐⭐⭐⭐⭐ | 机构专用 |
| **东方财富Choice** | ❌ 付费 | ✅ 需要合同 | ⭐⭐⭐⭐⭐ | 机构专用 |

### 5.2 AkShare详解

**数据覆盖：**
- A股：实时行情、历史数据、财务报表、股东信息
- 港股：实时行情、历史数据
- 美股：实时行情、历史数据
- 期货、期权、基金、债券、外汇
- 宏观经济数据

**使用示例：**
```python
import akshare as ak

# A股历史数据
df = ak.stock_zh_a_hist(symbol="000001", period="daily")

# 实时行情
df_spot = ak.stock_zh_a_spot_em()

# 财务报表
df_balance = ak.stock_financial_report_sina(stock="000001", symbol="资产负债表")

# 港股数据
df_hk = ak.stock_hk_spot_em()

# 美股数据
df_us = ak.stock_us_spot_em()
```

**优势：**
- ✅ 真正的开箱即用（pip install即可）
- ✅ 数据源多样（爬取多个财经网站）
- ✅ 持续更新（社区活跃）
- ✅ 中文文档完善

**劣势：**
- ❌ 数据稳定性依赖源网站
- ❌ 历史数据不如TuShare Pro完整
- ❌ 无官方技术支持

---

## 六、常见问题解答

### Q1: AkShare在Go/Java中能开箱即用吗？

**答：不能。**

- AkShare只有Python版本
- Go/Java需要通过AKTools HTTP API间接调用
- 需要额外的部署和配置
- 不如Python版本直接和方便

### Q2: 我现在做持仓分析，属于哪一层？

**答：研究层。**

- 分析历史持仓表现 → 研究层
- 回测历史策略 → 研究层
- 生成分析报告 → 研究层
- ✅ Python + AkShare是最佳选择

### Q3: 什么时候需要实时行情？

**答：准备实盘自动交易时。**

需要实时行情的场景：
- ✅ 实盘自动交易（策略自动下单）
- ✅ 日内交易（T+0策略）
- ✅ 止损/止盈自动执行
- ✅ 套利策略（监控价差）

不需要实时行情的场景：
- ❌ 策略回测（用历史数据）
- ❌ 持仓分析（分析已有数据）
- ❌ 因子研究（探索历史规律）

### Q4: Python性能不够怎么办？

**答：分层优化。**

```python
# 如果Python真的成为瓶颈
# 1. 先优化Python代码
import numpy as np  # 向量化计算
import numba        # JIT编译

# 2. 使用多进程
from multiprocessing import Pool

# 3. 只有执行层才考虑换语言
# 研究层和策略层保持Python
```

**实际经验：**
- 99%的个人量化项目不会遇到Python性能瓶颈
- 瓶颈通常在策略逻辑，不是语言性能

### Q5: 我应该学习Go/Java吗？

**答：看职业规划。**

**继续深耕Python，如果：**
- ✅ 专注个人量化投资
- ✅ 做策略研究和回测
- ✅ 策略以日线/分钟线为主

**学习Go/Java，如果：**
- ✅ 准备进入量化行业工作
- ✅ 想构建高频交易系统
- ✅ 对系统架构感兴趣

---

## 七、学习路径建议

### 7.1 个人量化投资者（当前阶段）

```
第一阶段：Python基础 (1-2个月)
├── Python语法
├── pandas数据处理
├── numpy数值计算
└── matplotlib可视化

第二阶段：金融数据分析 (2-3个月)
├── AkShare数据获取          ← 你在这里
├── 技术指标计算
├── 因子分析
└── 持仓分析

第三阶段：策略回测 (3-6个月)
├── backtrader框架
├── 策略开发
├── 回测优化
└── 风险管理

第四阶段：实盘准备（可选）
├── 实时行情接入
├── 模拟交易
└── 小资金实盘测试
```

### 7.2 专业量化方向

```
研究方向：
Python深度学习 → 机器学习选股 → 因子挖掘

开发方向：
Python基础 → Java/Go学习 → 系统架构 → 高频交易
```

---

## 八、总结

### 核心观点

1. **量化系统分三层**：研究层 → 策略层 → 执行层
2. **个人量化研究**：Python + AkShare 是最优选择
3. **实时行情**：只有实盘交易时才需要
4. **性能优化**：只有高频交易才需要Go/C++
5. **技术选型**：根据策略频率和开发阶段选择

### 行动建议

**如果你是个人投资者（研究层）：**
- ✅ 继续使用Python + AkShare
- ✅ 专注于策略逻辑和风险控制
- ✅ 用历史数据验证策略有效性
- ❌ 暂时不要考虑实盘
- ❌ 不要被技术栈分散精力

**只有当策略稳定盈利后，再考虑：**
1. 接入实时行情（AkShare实时接口足够）
2. 小资金模拟实盘
3. 逐步扩大规模
4. 高频策略再考虑Go/C++重写

---

## 九、参考资源

### Python量化
- [AkShare文档](https://akshare.akfamily.xyz/)
- [TuShare文档](https://tushare.pro/)
- [Backtrader文档](https://www.backtrader.com/)
- [vnpy文档](https://www.vnpy.com/)

### Go金融库
- [finance-go](https://github.com/piquette/finance-go)
- [tushare-go](https://github.com/ShawnRong/tushare-go)
- [go-stock](https://github.com/ArvinLovegood/go-stock)

### Java金融库
- [yahoofinance-api](https://github.com/sstrickx/yahoofinance-api)
- [YFinance4J](https://github.com/tekichan/yfinance4j)

### 量化社区
- 聚宽（JoinQuant）
- 米筐（RiceQuant）
- 优矿（Uqer）
- 掘金量化

---

**最后的建议：没有好的策略，再快的执行也没用。专注于策略研究才是正道！** 📊
