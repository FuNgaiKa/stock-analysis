# 港股分析模块使用指南

## 概述

港股分析模块是对现有A股分析系统的扩展，提供全面的港股市场分析功能，包括指数分析、资金流向、AH股溢价对比等。

## 功能特性

### 1. 数据源 (`data_sources/hkstock_source.py`)

基于 AKShare 的港股数据源，提供以下数据：

- **港股指数数据**
  - 恒生指数 (HSI)
  - 恒生国企指数 (HSCEI)
  - 恒生科技指数 (HSTECH)
  - 历史数据回溯至 1990 年

- **个股数据**
  - 港股实时行情
  - 个股历史K线数据
  - 支持 4500+ 港股标的

- **南向资金**
  - 沪港通/深港通资金流向
  - 每日净流入数据
  - 累计流向统计

- **AH股溢价**
  - 180+ AH股对比数据
  - 溢价率实时监控
  - 溢价指数历史

### 2. 市场分析器 (`position_analysis/hk_market_analyzer.py`)

综合分析模块，提供：

#### 指数趋势分析
- 技术指标（MA20/60/120, RSI）
- 52周高低点分析
- 波动率计算
- 趋势判断（多头/空头/震荡）

#### 资金流向分析
- 南向资金流入流出统计
- 近3日/5日/20日累计
- 资金流向状态判断

#### AH股溢价分析
- 平均溢价率/中位溢价率
- 高溢价股票统计
- 溢价水平分类

#### 市场广度分析
- 涨跌家数统计
- 涨跌幅分布
- 市场状态判断

#### 综合评分
- 多维度评分系统
- 市场评级（强势/中性/弱势）
- 投资建议

### 3. 分析脚本 (`scripts/hk_stock_analysis/run_hk_analysis.py`)

命令行分析工具，提供格式化的分析报告。

## 使用方法

### 方式一：通过主程序

```bash
python main.py
# 选择 "2. 港股市场分析"
```

### 方式二：直接运行脚本

```bash
python scripts/hk_stock_analysis/run_hk_analysis.py
```

### 方式三：在代码中调用

```python
from position_analysis.hk_market_analyzer import HKMarketAnalyzer

# 创建分析器
analyzer = HKMarketAnalyzer()

# 执行综合分析
result = analyzer.comprehensive_analysis()

# 查看恒生指数分析
hsi = result['hsi_analysis']
print(f"恒指: {hsi['latest_price']:.2f} ({hsi['change_pct']:+.2f}%)")

# 查看南向资金
capital = result['capital_flow']
print(f"近5日南向资金: {capital['recent_5d_flow']:.2f} 亿元")

# 查看综合评分
score = result['comprehensive_score']
print(f"市场评级: {score['rating']}")
```

### 方式四：单独使用数据源

```python
from data_sources.hkstock_source import HKStockDataSource

source = HKStockDataSource()

# 获取恒生指数历史数据
hsi_df = source.get_hk_index_daily("HSI")
print(hsi_df.tail())

# 获取南向资金
south_df = source.get_south_capital_flow(days=20)
print(south_df)

# 获取AH股溢价
ah_df = source.get_ah_price_comparison()
print(ah_df)

# 获取市场概况
summary = source.get_market_summary()
print(summary)
```

## 分析报告示例

```
======================================================================
港股市场综合分析报告
分析时间: 2025-10-10 18:00:00
======================================================================

【恒生指数】
  最新点位: 26290.32
  涨跌幅: -1.73% (-462.45点)
  趋势状态: 震荡整理
  技术指标:
    - MA20: 26450.12
    - MA60: 26780.45
    - MA120: 26920.88
    - RSI: 45.23
  52周表现:
    - 52周最高: 28500.00 (距离: -7.75%)
    - 52周最低: 24000.00 (距离: +9.54%)
  年化波动率: 18.5%

【恒生科技指数】
  最新点位: 5200.45
  涨跌幅: -2.10% (-111.23点)
  趋势状态: 空头趋势
  RSI: 38.90

【南向资金流向】
  近3日累计: -12.50 亿元
  近5日累计: -3.99 亿元
  总计流向: 2345.67 亿元
  日均流向: 117.28 亿元
  流向状态: 小幅流出
  净流入天数: 8/20 天

【AH股溢价分析】
  AH股对数: 180 只
  平均溢价率: 125.34%
  中位溢价率: 118.56%
  溢价率区间: 85.20% ~ 180.45%
  高溢价股票: 45 只 (>30%)
  H股溢价股票: 12 只
  溢价水平: A股温和溢价

【市场广度】
  总股票数: 4559 只
  上涨: 1245 只 (27.3%)
  下跌: 2980 只 (65.4%)
  平盘: 334 只
  涨幅>3%: 234 只
  涨幅>5%: 89 只
  跌幅>3%: 567 只
  跌幅>5%: 234 只
  市场状态: 多数下跌

【综合评分】
  综合得分: 0.30/1.00
  市场评级: 中性偏弱
  评分因子:
    - 指数趋势: 0.15
    - 资金流向: 0.05
    - 市场广度: 0.05
    - AH溢价: 0.10

【投资建议】
  市场偏弱，建议保持谨慎。可关注防御性板块或等待更好时机。

  风险提示:
    - 南向资金近期流出，市场情绪偏弱
    - 市场广度较差，仅27.3%个股上涨

======================================================================
```

## 技术指标说明

### 趋势判断逻辑
- **完美多头排列**: 价格 > MA20 > MA60 > MA120
- **多头趋势**: 价格 > MA20 > MA60
- **震荡整理**: 均线粘合/交叉
- **空头趋势**: 价格 < MA20 < MA60
- **完美空头排列**: 价格 < MA20 < MA60 < MA120

### RSI 信号
- RSI > 70: 超买，短期回调风险
- RSI 30-70: 正常区间
- RSI < 30: 超卖，可能反弹

### 资金流向状态
- 持续大幅流入: 近5日 > 100亿 且 近3日 > 50亿
- 持续流入: 近5日 > 50亿
- 小幅流入: 近5日 > 0
- 小幅流出: 近5日 -50 到 0亿
- 持续流出: 近5日 -100 到 -50亿
- 持续大幅流出: 近5日 < -100亿

### AH溢价水平
- A股高溢价: 中位溢价率 > 130%
- A股温和溢价: 中位溢价率 100-130%
- 基本平价: 中位溢价率 100-115%
- H股溢价: 中位溢价率 < 100%

### 市场广度状态
- 普涨行情: 上涨比例 > 70%
- 多数上涨: 上涨比例 60-70%
- 涨跌均衡: 上涨比例 40-60%
- 多数下跌: 上涨比例 30-40%
- 普跌行情: 上涨比例 < 30%

## 数据更新频率

- **指数数据**: 日线级别，每日收盘后更新
- **实时行情**: 盘中实时更新（有5分钟缓存）
- **南向资金**: 每日收盘后更新
- **AH溢价**: 每日更新

## 注意事项

1. **网络要求**: 需要能访问东方财富等数据源
2. **数据延迟**: 部分数据可能有1-2天延迟
3. **缓存机制**: 默认5分钟缓存，避免频繁请求
4. **错误处理**: 网络异常时会自动跳过失败的数据项

## 后续优化方向

### Phase 2 - 个股分析
- [ ] 港股个股选股器
- [ ] 技术面多维度筛选
- [ ] 基本面财务分析
- [ ] 个股估值分析

### Phase 3 - 回测系统
- [ ] 港股历史回测框架
- [ ] 策略信号生成
- [ ] 绩效评估
- [ ] 多策略组合

### Phase 4 - 对比分析
- [ ] A股 vs 港股对比
- [ ] AH股配对交易策略
- [ ] 跨市场套利分析

### Phase 5 - 实时监控
- [ ] 实时行情推送
- [ ] 异动提醒
- [ ] 自定义策略监控

## 联系方式

如有问题或建议，欢迎提交 Issue。

---

**免责声明**: 本模块仅供学习和研究使用，不构成投资建议。投资有风险，入市需谨慎。
