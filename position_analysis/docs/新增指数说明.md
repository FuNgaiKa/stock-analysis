# 新增指数支持说明

## 已添加的指数

### ✅ 默认分析的指数（4个）

1. **上证指数** (sh000001)
2. **沪深300** (sh000300)
3. **创业板指** (sz399006)
4. **科创50** (sh000688) ← **新增到默认列表**

### ✅ 支持但默认不分析

5. **深证成指** (sz399001)
6. **恒生科技** (hk_hstech) ← **新增港股支持**

## 使用方式

### 方式1：使用默认配置（推荐）

```bash
python run_position_analysis.py
```

自动分析：上证、沪深300、创业板指、科创50

### 方式2：自定义指数列表

编辑 `position_analysis/main.py` 第562行：

```python
# 默认配置
indices_to_analyze = ['sh000001', 'sh000300', 'sz399006', 'sh000688']

# 添加深证成指
indices_to_analyze.append('sz399001')

# 添加恒生科技（需要网络稳定）
indices_to_analyze.append('hk_hstech')
```

### 方式3：程序化调用

```python
from position_analysis import PositionAnalysisEngine

# 自定义指数
engine = PositionAnalysisEngine(
    indices=['sh000001', 'sh000688', 'hk_hstech']
)

results = engine.run_full_analysis()
```

## 恒生科技指数说明

**数据源**: akshare - `stock_hk_index_daily_em(symbol='恒生科技指数')`

**注意事项**:
1. 港股数据接口有时不稳定，可能超时
2. 如果网络环境不佳，建议只分析A股指数
3. 默认配置中已注释掉恒生科技，需要时手动启用

**启用方法**:

在 `main.py` 中取消注释：

```python
# 可选：添加恒生科技（需要网络稳定）
indices_to_analyze.append('hk_hstech')  # 取消注释这行
```

## HTML报告显示

修复后，所有指数的图表都会正常显示：

```
📊 可视化分析
├─ 上证指数 - 涨跌概率
├─ 沪深300 - 涨跌概率
├─ 创业板指 - 涨跌概率
├─ 科创50 - 涨跌概率      ← 现在能看到了！
└─ 综合置信度
```

每个指数有独立的概率图表，包含5/10/20/60日4个周期的上涨/下跌概率柱状图。

## 技术细节

### Bug修复

**问题**: 所有指数使用相同的 `div_id="probability_chart"`，HTML中ID冲突

**解决**: 每个指数生成唯一ID

```python
# 修复前
div_id = "probability_chart"  # 所有指数都一样

# 修复后
div_id = f"probability_chart_{index_name}"  # 每个指数唯一
# 上证指数 → probability_chart_上证指数
# 科创50 → probability_chart_科创50
```

### 港股数据支持

在 `get_index_data()` 中添加了港股判断逻辑：

```python
if index_code.startswith('hk_'):
    # 港股指数
    df = ak.stock_hk_index_daily_em(symbol=symbol)
else:
    # A股指数
    df = ak.stock_zh_index_daily(symbol=index_code)
```

## 数据对比

| 指数 | 历史数据量 | 当前点位（2025-09-30） | 备注 |
|------|-----------|---------------------|------|
| 上证指数 | 8495条 | 3882.78 | 1991年至今 |
| 沪深300 | 5762条 | 4640.69 | 2005年至今 |
| 创业板指 | 3727条 | 3238.16 | 2010年至今 |
| **科创50** | **1395条** | **1495.29** | **2020年至今** |
| 深证成指 | 8403条 | 13526.51 | 1991年至今 |
| 恒生科技 | 待测试 | - | 2020年至今 |

**注意**: 科创50历史数据较短（仅4年），样本量相对较少，置信度可能偏低。

## 常见问题

### Q: 为什么HTML里只看到上证指数的图？

A: 已修复！现在所有指数都能正常显示。

### Q: 科创50数据少，结论准确吗？

A: 科创50仅有1395天历史数据，在某些点位区间样本可能不足10个，此时置信度会较低，建议参考其他指数综合判断。

### Q: 如何添加其他指数？

A: 在 `SUPPORTED_INDICES` 中添加配置：

```python
SUPPORTED_INDICES = {
    # ... 现有配置
    'new_index': IndexConfig('new_index', '指数名称', 'akshare_symbol'),
}
```

### Q: 恒生科技数据获取失败怎么办？

A:
1. 检查网络连接
2. 稍后重试（可能是接口限流）
3. 暂时只分析A股指数

---

**更新日期**: 2025-10-04
**影响范围**: HTML报告生成、指数配置
**测试状态**: ✅ 通过
