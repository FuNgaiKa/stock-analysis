# å›žæµ‹æ¡†æž¶ä½¿ç”¨æŒ‡å—

## ðŸ“Š å›žæµ‹æ¡†æž¶æ¦‚è¿°

å›žæµ‹æ¡†æž¶å¯ä»¥éªŒè¯å››æŒ‡æ ‡å…±æŒ¯ç­–ç•¥åœ¨åŽ†å²æ•°æ®ä¸Šçš„è¡¨çŽ°ï¼Œæä¾›è¯¦ç»†çš„æ€§èƒ½æŒ‡æ ‡å’Œäº¤æ˜“æ˜Žç»†ã€‚

## ðŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼1: è‡ªåŠ¨æµ‹è¯• (æœ€ç®€å•)

```bash
python test_backtest.py
```

è‡ªåŠ¨å›žæµ‹ä¸Šè¯æŒ‡æ•°500å¤©æ•°æ®ï¼Œè¾“å‡ºå®Œæ•´æ€§èƒ½æŠ¥å‘Šã€‚

### æ–¹å¼2: äº¤äº’å¼å›žæµ‹

```bash
python run_backtest.py
```

é€‰æ‹©å›žæµ‹æ¨¡å¼:
- **æ¨¡å¼1**: å•ä¸ªå›žæµ‹ - è‡ªå®šä¹‰æ‰€æœ‰å‚æ•°
- **æ¨¡å¼2**: å¿«é€Ÿå›žæµ‹ - ä¸Šè¯æŒ‡æ•°500å¤©
- **æ¨¡å¼3**: æ‰¹é‡å›žæµ‹ - å¯¹æ¯”3ä¸ªä¸»è¦æŒ‡æ•°

### æ–¹å¼3: Python API

```python
from trading_strategies.signal_generators.technical_indicators import TechnicalIndicators
from trading_strategies.signal_generators.resonance_signals import ResonanceSignalGenerator
from trading_strategies.backtesting.backtest_engine import BacktestEngine
from trading_strategies.backtesting.performance_metrics import PerformanceMetrics
import akshare as ak

# 1. èŽ·å–æ•°æ®
df = ak.stock_zh_index_daily(symbol='sh000001')
df = df.tail(500).set_index('date')

# 2. è®¡ç®—æŒ‡æ ‡
calculator = TechnicalIndicators()
df = calculator.calculate_all_indicators(df)

# 3. è¿è¡Œå›žæµ‹
generator = ResonanceSignalGenerator()
engine = BacktestEngine(
    initial_capital=100000,  # 10ä¸‡åˆå§‹èµ„é‡‘
    commission=0.0003,        # 0.03%æ‰‹ç»­è´¹
    stop_loss=0.08,          # 8%æ­¢æŸ
    take_profit=0.15          # 15%æ­¢ç›ˆ
)

result = engine.run_backtest_with_strategy(df, generator)

# 4. è®¡ç®—æ€§èƒ½
metrics = PerformanceMetrics()
performance = metrics.generate_performance_report(
    returns=result['daily_returns'],
    trades=result['trades'],
    initial_capital=100000
)

# 5. æ‰“å°æŠ¥å‘Š
metrics.print_performance_report(performance, "æˆ‘çš„ç­–ç•¥")
```

## ðŸ“‹ æ€§èƒ½æŒ‡æ ‡è¯´æ˜Ž

### æ”¶ç›ŠæŒ‡æ ‡
- **æ€»æ”¶ç›ŠçŽ‡**: ç­–ç•¥æœŸé—´çš„ç´¯è®¡æ”¶ç›Š
- **å¹´åŒ–æ”¶ç›ŠçŽ‡**: æ¢ç®—æˆå¹´åŒ–çš„æ”¶ç›ŠçŽ‡
- **æœŸæœ«èµ„é‡‘**: å›žæµ‹ç»“æŸæ—¶çš„æ€»èµ„é‡‘
- **ç›ˆäºé‡‘é¢**: å®žé™…ç›ˆäºé‡‘é¢

### é£Žé™©æŒ‡æ ‡
- **å¹´åŒ–æ³¢åŠ¨çŽ‡**: æ”¶ç›ŠçŽ‡çš„æ ‡å‡†å·®(å¹´åŒ–)
- **æœ€å¤§å›žæ’¤**: ä»Žæœ€é«˜ç‚¹åˆ°æœ€ä½Žç‚¹çš„æœ€å¤§è·Œå¹…
- **å›žæ’¤æŒç»­**: æœ€å¤§å›žæ’¤æŒç»­çš„å¤©æ•°
- **æ¢å¤æ—¶é—´**: ä»Žæœ€å¤§å›žæ’¤æ¢å¤åˆ°å‰é«˜çš„å¤©æ•°

### é£Žé™©è°ƒæ•´æ”¶ç›Š
- **å¤æ™®æ¯”çŽ‡**: (å¹´åŒ–æ”¶ç›Š - æ— é£Žé™©åˆ©çŽ‡) / å¹´åŒ–æ³¢åŠ¨çŽ‡
  - > 1.0: ä¼˜ç§€
  - 0.5-1.0: è‰¯å¥½
  - < 0.5: ä¸€èˆ¬
- **å¡çŽ›æ¯”çŽ‡**: å¹´åŒ–æ”¶ç›Š / |æœ€å¤§å›žæ’¤|
  - > 1.0: ä¼˜ç§€
  - 0.5-1.0: è‰¯å¥½

### äº¤æ˜“æŒ‡æ ‡
- **æ€»äº¤æ˜“æ¬¡æ•°**: å®Œæ•´ä¹°å–çš„æ¬¡æ•°
- **èƒœçŽ‡**: ç›ˆåˆ©äº¤æ˜“å æ¯”
- **å¹³å‡ç›ˆåˆ©/äºæŸ**: ç›ˆåˆ©å’ŒäºæŸäº¤æ˜“çš„å¹³å‡æ”¶ç›ŠçŽ‡
- **ç›ˆäºæ¯”**: æ€»ç›ˆåˆ© / æ€»äºæŸ
  - > 2.0: ä¼˜ç§€
  - 1.5-2.0: è‰¯å¥½
  - < 1.5: ä¸€èˆ¬

## ðŸ“Š å›žæµ‹ç»“æžœç¤ºä¾‹

### ä¸Šè¯æŒ‡æ•° 500å¤©å›žæµ‹

```
ã€æ”¶ç›ŠæŒ‡æ ‡ã€‘
  æ€»æ”¶ç›ŠçŽ‡:    14.99%
  å¹´åŒ–æ”¶ç›ŠçŽ‡:   7.29%
  æœŸæœ«èµ„é‡‘:      114,990 å…ƒ
  ç›ˆäºé‡‘é¢:       14,990 å…ƒ

ã€é£Žé™©æŒ‡æ ‡ã€‘
  å¹´åŒ–æ³¢åŠ¨çŽ‡:  12.28%
  æœ€å¤§å›žæ’¤:    16.03%

ã€é£Žé™©è°ƒæ•´æ”¶ç›Šã€‘
  å¤æ™®æ¯”çŽ‡:     0.35
  å¡çŽ›æ¯”çŽ‡:     0.45

ã€äº¤æ˜“æŒ‡æ ‡ã€‘
  æ€»äº¤æ˜“æ¬¡æ•°:     11
  èƒœçŽ‡:        36.36%
  ç›ˆäºæ¯”:       1.53
```

**åˆ†æž**:
- âœ… å¹´åŒ–æ”¶ç›Š7.29%ï¼Œè·‘èµ¢3%æ— é£Žé™©åˆ©çŽ‡
- âš ï¸ æœ€å¤§å›žæ’¤16%ï¼Œéœ€è¦æ‰¿å—ä¸€å®šé£Žé™©
- âš ï¸ èƒœçŽ‡36%åä½Žï¼Œä½†ç›ˆäºæ¯”1.53è¡¥å¿
- ðŸ’¡ å…¸åž‹çš„"ä½ŽèƒœçŽ‡é«˜ç›ˆäºæ¯”"ç­–ç•¥

## ðŸŽ¯ ä¼˜åŒ–å»ºè®®

### æé«˜èƒœçŽ‡
1. **è°ƒæ•´å…±æŒ¯é˜ˆå€¼**: ä¹°å…¥è¯„åˆ†ä»Ž70æé«˜åˆ°75
2. **å¢žåŠ è¿‡æ»¤æ¡ä»¶**: åªåœ¨è¶‹åŠ¿å‘ä¸Šæ—¶äº¤æ˜“
3. **ä¼˜åŒ–å‚æ•°**: è°ƒæ•´MACD/RSI/KDJå‚æ•°

### é™ä½Žå›žæ’¤
1. **æ”¶ç´§æ­¢æŸ**: ä»Ž8%é™åˆ°5-6%
2. **åˆ†æ‰¹å»ºä»“**: ä¸è¦ä¸€æ¬¡æ€§æ»¡ä»“
3. **è¶‹åŠ¿è¿‡æ»¤**: åªåœ¨MAå¤šå¤´æŽ’åˆ—æ—¶äº¤æ˜“

### æé«˜ç›ˆäºæ¯”
1. **æ”¾å®½æ­¢ç›ˆ**: ä»Ž15%æé«˜åˆ°20%
2. **ç§»åŠ¨æ­¢æŸ**: ç›ˆåˆ©åŽç§»åŠ¨æ­¢æŸä¿æŠ¤åˆ©æ¶¦
3. **é‡‘å­—å¡”åŠ ä»“**: ç›ˆåˆ©åŽå°å¹…åŠ ä»“

## ðŸ› ï¸ å‚æ•°é…ç½®

### å›žæµ‹å‚æ•°

```python
engine = BacktestEngine(
    initial_capital=100000,   # åˆå§‹èµ„é‡‘
    commission=0.0003,        # æ‰‹ç»­è´¹çŽ‡(åŒè¾¹)
    slippage=0.0001,          # æ»‘ç‚¹
    stop_loss=0.08,           # æ­¢æŸæ¯”ä¾‹
    take_profit=0.15,         # æ­¢ç›ˆæ¯”ä¾‹
)
```

### ä¿¡å·å‚æ•°

å¯åœ¨`technical_indicators.py`ä¸­è°ƒæ•´:

```python
# MACDå‚æ•°
calculate_macd(fast_period=12, slow_period=26, signal_period=9)

# RSIå‚æ•°
calculate_rsi(period=14)

# KDJå‚æ•°
calculate_kdj(n=9, m1=3, m2=3)

# MAå‘¨æœŸ
calculate_ma(periods=[5, 10, 20, 60])
```

## ðŸ“ˆ å¯è§†åŒ–å›¾è¡¨

### ç”Ÿæˆå›žæµ‹å›¾è¡¨

```python
# åœ¨å›žæµ‹åŽè°ƒç”¨
engine.plot_results(df, save_path='my_backtest.png')
```

ç”Ÿæˆ3å¼ å›¾:
1. **ç»„åˆä»·å€¼æ›²çº¿** - èµ„é‡‘å¢žé•¿æƒ…å†µ
2. **ä»·æ ¼ä¸Žäº¤æ˜“ç‚¹** - ä¹°å–ç‚¹æ ‡æ³¨
3. **ç´¯è®¡æ”¶ç›ŠçŽ‡** - æ”¶ç›ŠçŽ‡èµ°åŠ¿

## âš ï¸ æ³¨æ„äº‹é¡¹

### è¿‡æ‹Ÿåˆé£Žé™©
- ä¸è¦è¿‡åº¦ä¼˜åŒ–å‚æ•°ä»¥é€‚åº”åŽ†å²æ•°æ®
- æ ·æœ¬å¤–æµ‹è¯•ï¼šç•™ä¸€éƒ¨åˆ†æ•°æ®ä¸å‚ä¸Žä¼˜åŒ–
- å‚æ•°ç¨³å®šæ€§ï¼šå°å¹…è°ƒæ•´å‚æ•°ä¸åº”å¯¼è‡´ç»“æžœå‰§å˜

### äº¤æ˜“æˆæœ¬
- å®žç›˜æ‰‹ç»­è´¹å¯èƒ½é«˜äºŽ0.03%
- æ»‘ç‚¹åœ¨å¤§å•æˆ–æ³¢åŠ¨å¤§æ—¶æ›´æ˜Žæ˜¾
- è€ƒè™‘å°èŠ±ç¨Ž(å–å‡ºæ—¶0.1%)

### å¸‚åœºçŽ¯å¢ƒ
- ç‰›å¸‚/ç†Šå¸‚/éœ‡è¡å¸‚è¡¨çŽ°å¯èƒ½ä¸åŒ
- åˆ†åˆ«æµ‹è¯•ä¸åŒå¸‚åœºçŽ¯å¢ƒ
- ç­–ç•¥å¯èƒ½æ›´é€‚åˆæŸç§å¸‚åœº

## ðŸ”„ æ‰¹é‡å›žæµ‹

### å¯¹æ¯”ä¸åŒæ ‡çš„

```bash
python run_backtest.py
# é€‰æ‹©æ¨¡å¼3
```

è¾“å‡ºå¯¹æ¯”è¡¨:
```
code       name      total_return  annual_return  sharpe  max_dd   win_rate
sh000001   ä¸Šè¯æŒ‡æ•°    14.99%        7.29%         0.35    -16.03%  36.36%
sz399006   åˆ›ä¸šæ¿æŒ‡    22.15%        10.82%        0.52    -18.52%  42.86%
sh000300   æ²ªæ·±300     18.45%        9.01%         0.44    -15.21%  38.89%
```

### å¯¹æ¯”ä¸åŒå‚æ•°

```python
# æµ‹è¯•ä¸åŒæ­¢æŸ
for stop_loss in [0.05, 0.08, 0.10, 0.12]:
    engine = BacktestEngine(stop_loss=stop_loss, ...)
    result = engine.run_backtest_with_strategy(df, generator)
    # è®°å½•ç»“æžœ
```

## ðŸ“š è¿›é˜¶åŠŸèƒ½

### æ»šåŠ¨å›žæµ‹

æµ‹è¯•ç­–ç•¥åœ¨ä¸åŒæ—¶é—´æ®µçš„ç¨³å®šæ€§:

```python
window = 252  # ä¸€å¹´
step = 63     # ä¸€ä¸ªå­£åº¦

for i in range(0, len(df) - window, step):
    df_window = df.iloc[i:i+window]
    # è¿è¡Œå›žæµ‹
    # è®°å½•ç»“æžœ
```

### è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿ

æµ‹è¯•ç­–ç•¥çš„é²æ£’æ€§:

```python
for _ in range(1000):
    # éšæœºæ‰“ä¹±äº¤æ˜“é¡ºåº
    shuffled_trades = np.random.permutation(trades)
    # è®¡ç®—æ€§èƒ½
    # è®°å½•åˆ†å¸ƒ
```

## ðŸ’¡ æœ€ä½³å®žè·µ

1. **å…ˆæµ‹è¯•åŽå®žç›˜**: å……åˆ†å›žæµ‹éªŒè¯ç­–ç•¥
2. **ä¿å®ˆå‚æ•°**: å®žç›˜å‚æ•°æ¯”å›žæµ‹æ›´ä¿å®ˆ
3. **å°èµ„é‡‘è¯•é”™**: å…ˆç”¨å°èµ„é‡‘éªŒè¯
4. **è®°å½•äº¤æ˜“**: å®žç›˜è®°å½•ä¸Žå›žæµ‹å¯¹æ¯”
5. **å®šæœŸå¤ç›˜**: æ¯æœˆ/å­£åº¦å¤ç›˜ç­–ç•¥è¡¨çŽ°

---

**Made with â¤ï¸ by Claude & Russ**
