# 四大科技指数综合分析系统

## 📊 功能概述

每日自动分析四大科技指数（创业板指、科创50、恒生科技、纳斯达克），提供7大维度的综合分析报告。

### 分析对象
- 🇨🇳 **创业板指** - 中国创新型企业代表
- 🇨🇳 **科创50** - 中国科创板龙头
- 🇭🇰 **恒生科技** - 香港科技股指数
- 🇺🇸 **纳斯达克** - 全球科技股风向标

### 分析维度

1. **历史点位分析** ⭐⭐⭐
   - 查找相似历史点位
   - 计算未来20日/60日涨跌概率
   - 平均收益/收益中位数/置信度

2. **技术面分析** ⭐⭐⭐
   - MACD金叉/死叉
   - RSI超买/超卖
   - KDJ指标(K/D/J值,金叉/死叉)
   - 布林带(上中下轨,当前位置)
   - ATR波动率(真实波幅)
   - DMI/ADX趋势强度分析
   - 均线偏离度(MA5/MA20/MA60)
   - 背离信号检测(MACD/RSI/量价背离)

3. **资金面分析** ⭐⭐
   - A股: 北向资金(外资流向)
   - 港股: 南向资金(内地资金流向)
   - 资金流向状态/情绪评分

4. **估值分析** ⭐
   - PE/PB分位数(待集成数据源)

5. **市场情绪** ⭐
   - 涨停/跌停数量(仅A股)
   - 市场热度判断

6. **风险评估** ⭐⭐⭐
   - 综合风险评分(0-1)
   - 风险等级(低/中/高/极高)
   - 具体风险因素列表

7. **综合判断** ⭐⭐⭐
   - 方向判断(看多/中性/看空)
   - 建议仓位(20%-80%)
   - 操作策略建议
   - 组合策略匹配(牛市/熊市/抄底/逃顶)

---

## 🚀 快速开始

### 1. 运行分析(控制台输出)

```bash
cd /Users/russ/PycharmProjects/stock-analysis
python scripts/tech_indices_analysis/run_tech_comprehensive_analysis.py
```

**输出示例**:
```
================================================================================
【创业板指】
================================================================================

【当前点位】
  最新价格: 2955.98
  涨跌幅: -3.99%

【历史点位分析】
  未来20日:
    上涨概率: 51.1% (下跌概率: 48.9%)
    平均收益: +1.10%
    置信度: 60.8%

【技术面分析】
  MACD: 死叉🔴
  RSI: 41.4 😊
  KDJ: K=22.3, D=38.0, J=-9.3 死叉🔴 ✅
  布林带: 上=3315.30, 中=3100.76, 下=2886.21
         当前位置: 16% ✅ 接近下轨
  ATR(波动率): 105.21 (3.56%)
  DMI/ADX: +DI=20.9, -DI=22.4, ADX=38.5
          趋势强度: strong 🔥, 方向: 📉
  均线偏离:
    MA5: -5.55%
    MA20: -4.67%
    MA60: +8.91%

【风险评估】
  综合风险: 0.00 (低风险🟢)

【综合判断】
  方向判断: 中性偏多⚖️
  建议仓位: 50-60%
  操作策略:
    • 历史概率支持,可以配置
    • ✅ 低风险,可以持有
```

### 2. 发送邮件报告

```bash
python scripts/tech_indices_analysis/run_tech_comprehensive_analysis.py --email
```

**邮件将发送到**: `1264947688@qq.com`

**邮件效果**:
- ✅ 精美HTML格式
- ✅ 四大指数对比卡片
- ✅ 风险评估高亮
- ✅ 组合策略匹配提示
- ✅ 移动端友好

### 3. 保存到文件

```bash
python scripts/tech_indices_analysis/run_tech_comprehensive_analysis.py --save reports/tech_$(date +%Y%m%d).txt
```

---

## ⚙️ 配置邮件发送

### 步骤1: 复制配置文件模板

```bash
cp config/email_config.yaml.template config/email_config.yaml
```

### 步骤2: 获取QQ邮箱授权码

1. 登录QQ邮箱 (mail.qq.com)
2. 进入**设置** → **账户**
3. 找到 **POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务**
4. 开启 **POP3/SMTP服务** 或 **IMAP/SMTP服务**
5. 点击**生成授权码**，按提示发送短信
6. 复制生成的授权码(16位字母)

### 步骤3: 编辑配置文件

```yaml
# config/email_config.yaml
smtp:
  server: smtp.qq.com
  port: 465

sender:
  email: your_email@qq.com       # 你的QQ邮箱
  password: abcd1234efgh5678      # 填入刚才的授权码
  name: 科技指数分析系统

recipients:
  - 1264947688@qq.com             # 收件人(已固定)
```

### 步骤4: 测试邮件发送

```bash
python scripts/tech_indices_analysis/run_tech_comprehensive_analysis.py --email
```

如果看到 `✅ 邮件发送成功`，说明配置正确！

---

## ⏰ 每日自动执行

### 方式1: crontab定时任务(推荐)

```bash
# 编辑crontab
crontab -e

# 添加以下行(每天下午3点执行,美股开盘前)
0 15 * * * cd /Users/russ/PycharmProjects/stock-analysis && /usr/bin/python3 scripts/tech_indices_analysis/run_tech_comprehensive_analysis.py --email >> logs/tech_analysis.log 2>&1
```

**执行时间建议**:
- 🇨🇳 A股: 15:30后(收盘后)
- 🇭🇰 港股: 16:30后(收盘后)
- 🇺🇸 美股: 次日早上6:00(美东时间16:00收盘后)

**综合建议**: 每天**下午3点**或**晚上22点**执行

### 方式2: 使用提供的cron脚本

```bash
# 查看cron脚本
cat scripts/tech_indices_analysis/setup_daily_cron.sh

# 执行安装
bash scripts/tech_indices_analysis/setup_daily_cron.sh
```

---

## 📖 策略解读

### 历史点位分析

**原理**: 找到历史上价格相近的时期，统计后续涨跌情况

**示例**:
```
当前价格: 2955
相似点位: 96个 (±5%区间内)
20日上涨概率: 51% → 历史上51%的情况后续上涨
平均收益: +1.1% → 平均涨幅1.1%
置信度: 61% → 样本量中等，可参考
```

**如何使用**:
- 上涨概率 > 60% → 偏多信号
- 上涨概率 < 40% → 偏空信号
- 置信度 > 70% → 结果可靠
- 置信度 < 50% → 参考价值有限

### 风险评分

**评分范围**: 0.0 - 1.0 (越高越危险)

**评分构成**:
- 30% 历史概率风险
- 30% 技术面风险(MACD背离/RSI超买)
- 20% 资金面风险(资金流出)
- 20% 市场情绪风险(涨停过多)

**风险等级**:
- < 0.3 → 🟢 低风险
- 0.3-0.5 → 🟡 中风险
- 0.5-0.7 → 🟠 高风险
- > 0.7 → 🔴 极高风险

### 组合策略匹配

#### 牛市确认组合(5/5项)
```
✅ 历史概率 > 60%
✅ 风险评分 < 0.4
✅ MACD金叉
✅ RSI健康(30-70)
✅ 资金流入

→ 满足4项以上 → 强烈看多,可重仓70-80%
```

#### 熊市确认组合(5/5项)
```
🔴 历史概率 < 40%
🔴 风险评分 > 0.6
🔴 MACD死叉或顶背离
🔴 RSI超买(>70)
🔴 资金流出

→ 满足3项以上 → 熊市特征,减仓至20-30%
```

#### 抄底组合(3/3项)
```
✅ RSI < 30 (严重超卖)
✅ 资金开始流入
✅ 历史概率 > 50%

→ 满足2-3项 → 可能是底部,分批建仓
```

#### 逃顶组合(4/4项)
```
🔴 MACD顶背离
🔴 RSI > 80
🔴 风险评分 > 0.7
🔴 资金流出

→ 满足2项以上 → 顶部特征明显,强烈建议减仓
```

---

## 🔧 高级用法

### 只分析特定指数

修改 `tech_indices_reporter.py` 中的 `TECH_INDICES` 字典：

```python
# 只分析纳斯达克和恒生科技
TECH_INDICES = {
    'HKTECH': {'market': 'HK', 'name': '恒生科技', 'code': 'HSTECH'},
    'NASDAQ': {'market': 'US', 'name': '纳斯达克', 'code': 'NASDAQ'}
}
```

### 调整容差范围

历史点位匹配的容差默认是 ±5%，可在代码中调整：

```python
# tech_indices_reporter.py 第129行
result = analyzer.analyze_single_index(code, tolerance=0.05)  # 改为0.03 = ±3%
```

### 自定义风险评分权重

在 `_calculate_risk_score` 方法中调整各维度权重。

---

## 📊 数据来源

- **A股数据**: Ashare (腾讯+新浪双核心)
- **港股数据**: yfinance
- **美股数据**: yfinance
- **北向资金**: Akshare
- **南向资金**: Akshare

---

## ❓ 常见问题

### Q1: 邮件发送失败?

**检查清单**:
1. ✅ `config/email_config.yaml` 是否存在
2. ✅ 邮箱地址和授权码是否正确
3. ✅ 授权码是否包含空格(应该去掉)
4. ✅ 网络是否正常

### Q2: 分析速度慢?

正常情况下约需1-2分钟。慢的原因:
- 数据获取需要时间(美股/港股需要访问外网)
- 背离分析需要计算大量指标
- AH溢价需要获取180只股票数据

**优化建议**: 使用缓存,第二次运行会快很多

### Q3: 如何理解"置信度"?

置信度综合了两个因素:
1. 样本量 (相似点位数量)
2. 一致性 (上涨/下跌的比例)

**示例**:
- 样本20个,上涨15个 → 置信度约60%
- 样本100个,上涨80个 → 置信度约90%

### Q4: 纳斯达克显示100%上涨概率?

这可能是因为:
1. 纳斯达克处于历史高位,相似点位少
2. 历史上所有相似点位后续都上涨了

**注意**: 即使概率100%,也要结合技术面(如MACD背离)综合判断！

---

## 📝 更新日志

### v1.1.0 (2025-10-15)
- ✨ 新增KDJ指标分析
- ✨ 新增布林带(BOLL)指标
- ✨ 新增ATR波动率指标
- ✨ 新增DMI/ADX趋势强度分析
- 📊 技术面分析更加全面

### v1.0.0 (2025-10-15)
- ✨ 初始版本发布
- ✅ 支持四大科技指数分析
- ✅ 7大维度综合分析
- ✅ 组合策略匹配
- ✅ 邮件发送功能
- ✅ HTML精美报告

---

## 🤝 贡献

由 **Claude Code** 和 **Russ** 共同开发

如有问题或建议，欢迎反馈！

---

**祝您投资顺利！📈**
